#!/usr/bin/env bash
# -*- coding: utf-8 -*-
# NeoZork Interactive System Script
# 
# This script provides an interactive interface for the entire NeoZork HLD system,
# including EDA, Feature Engineering, and other capabilities.

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$SCRIPT_DIR"

# Add project root to Python path
export PYTHONPATH="${PROJECT_ROOT}:${PYTHONPATH}"

# Function to detect environment
detect_environment() {
    if [ -f "/.dockerenv" ] || [ -f "/app/.dockerenv" ]; then
        echo "Docker environment detected"
        return 0
    elif command -v uv >/dev/null 2>&1; then
        echo "UV environment detected"
        return 1
    else
        echo "Native Python environment detected"
        return 2
    fi
}

# Function to run Python command
run_python() {
    local env_type=$1
    shift
    
    case $env_type in
        0)  # Docker
            python "$@"
            ;;
        1)  # UV
            uv run python "$@"
            ;;
        2)  # Native
            python "$@"
            ;;
    esac
}

# Main script logic
echo "ðŸš€ NeoZork HLD Prediction - Interactive System"
echo "==============================================="

# Detect environment
detect_environment
env_type=$?

# Change to project root
cd "$PROJECT_ROOT"

# Add script directory to PATH
echo "Adding $SCRIPT_DIR to PATH"
export PATH="$SCRIPT_DIR:$PATH"

# Parse arguments
if [ $# -eq 0 ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    echo "Usage: $0 [OPTIONS]"
    echo ""
    echo "Options:"
    echo "  --help, -h              Show this help message"
    echo "  --version, -v           Show version information"
    echo "  --demo                  Run demo mode"
    echo "  --eda                   Run EDA analysis only"
    echo "  --features              Run feature engineering only"
    echo "  --full                  Run full interactive system"
    echo ""
    echo "Examples:"
    echo "  # Run full interactive system"
    echo "  $0 --full"
    echo ""
    echo "  # Run EDA analysis"
    echo "  $0 --eda"
    echo ""
    echo "  # Run feature engineering"
    echo "  $0 --features"
    echo ""
    echo "  # Demo mode"
    echo "  $0 --demo"
    echo ""
    echo "Environment:"
    echo "  Automatically detects Docker, UV, or native Python environment"
    echo ""
    exit 0
fi

# Run the appropriate mode
case "$1" in
    --demo)
        echo "Running demo mode..."
        run_python $env_type scripts/demo_feature_engineering.py
        ;;
    --eda)
        echo "Running EDA analysis..."
        run_python $env_type scripts/eda_feature_engineering.py --file data.csv --eda-only
        ;;
    --features)
        echo "Running feature engineering..."
        run_python $env_type scripts/eda_feature_engineering.py --file data.csv --features-only
        ;;
    --full)
        echo "Starting full interactive system..."
        run_python $env_type scripts/interactive_system.py
        ;;
    --version|-v)
        echo "NeoZork Interactive System v1.0.0"
        ;;
    *)
        echo "Unknown option: $1"
        echo "Use --help for usage information"
        exit 1
        ;;
esac
