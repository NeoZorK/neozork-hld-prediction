#!/bin/bash

# Determine the project directory
PROJECT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$PROJECT_DIR"

# Add this script's directory to PATH if not already there
if [[ ":$PATH:" != *":$PROJECT_DIR:"* ]]; then
    echo "Adding $PROJECT_DIR to PATH for this session"
    export PATH="$PROJECT_DIR:$PATH"

    # Suggest adding to PATH permanently
    echo "To add this directory to PATH permanently, add the following line to your ~/.bashrc or ~/.zshrc:"
    echo "export PATH=\"$PROJECT_DIR:\$PATH\""
fi

# Check if running inside a Docker container
# The /.dockerenv file exists in all Docker containers
IN_DOCKER=false
if [ -f /.dockerenv ] || grep -q docker /proc/1/cgroup 2>/dev/null; then
    IN_DOCKER=true
    echo "Running inside Docker container"
fi

# If we're already in Docker, run the command directly with python
if $IN_DOCKER; then
    echo "Running in Docker environment..."
    python run_analysis.py "$@"
else
    # If not in Docker, use uv run to ensure proper environment
    echo "Running in native environment with uv..."
    
    # Check if uv is available
    if command -v uv &> /dev/null; then
        uv run python run_analysis.py "$@"
    else
        echo "Warning: uv not found, trying direct python execution..."
        python run_analysis.py "$@"
    fi
fi
