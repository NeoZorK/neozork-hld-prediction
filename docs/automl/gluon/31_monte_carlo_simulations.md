# –£–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∏–∫ Monte Carlo - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–±–∞—Å—Ç–Ω—ã—Ö –∏ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

**–ê–≤—Ç–æ—Ä:** Shcherbyna Rostyslav  
**–î–∞—Ç–∞:** 2024  

## –ü–æ—á–µ–º—É Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏ - –∫–ª—é—á –∫ —Ä–æ–±–∞—Å—Ç–Ω—ã–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º

### üéØ –í–∞–∂–Ω–æ—Å—Ç—å Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–±–∞—Å—Ç–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```mermaid
graph TD
    A[ML-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è] --> B{–ü—Ä–æ—à–ª–∞ –ª–∏ Monte Carlo —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?}
    
    B -->|–ù–µ—Ç| C[95% —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ç–µ—Ä–ø—è—Ç –Ω–µ—É–¥–∞—á—É]
    C --> D[‚ùå –õ–æ–∂–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö]
    C --> E[‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ]
    C --> F[‚ùå –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å]
    C --> G[‚ùå –ü–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–Ω–µ–≥]
    
    B -->|–î–∞| H[5% —É—Å–ø–µ—à–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π]
    H --> I[‚úÖ –†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤]
    H --> J[‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø–æ—Ç–µ—Ä—è–º–∏]
    H --> K[‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏]
    H --> L[‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö]
    
    I --> M[–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 10,000+ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤]
    J --> N[–ü–æ–Ω–∏–º–∞–Ω–∏–µ VaR –∏ Expected Shortfall]
    K --> O[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏]
    L --> P[–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ –∫–≤–∞–Ω—Ç–∏–ª–∏]
    
    M --> Q[–†–æ–±–∞—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è]
    N --> Q
    O --> Q
    P --> Q
    
    Q --> R[‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö]
    
    style A fill:#e3f2fd
    style H fill:#c8e6c9
    style C fill:#ffcdd2
    style R fill:#4caf50
```

**–ü–æ—á–µ–º—É 95% ML-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ç–µ—Ä–ø—è—Ç –Ω–µ—É–¥–∞—á—É –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ?** –ü–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—à–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö. Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏ - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –≤–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç—ã—Å—è—á–∞—Ö —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π.

### –ß—Ç–æ –¥–∞—é—Ç Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏

- **–†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏**: –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å**: –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

- **–õ–æ–∂–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å**: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏**: –†–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö—É–∂–µ –æ–∂–∏–¥–∞–µ–º—ã—Ö
- **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–Ω–µ–≥

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

**Monte Carlo –∫–∞–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞:**

```math
P(Strategy_Success) = ‚à´ P(Success|Parameters, Market_Conditions) √ó P(Market_Conditions) d(Market_Conditions)
```

–ì–¥–µ:

- `P(Strategy_Success)` - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `P(Success|Parameters, Market_Conditions)` - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- `P(Market_Conditions)` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π:**

1. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å**: p-value < 0.05
2. **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å**: Sharpe > 1.0 –≤ 95% —Å–ª—É—á–∞–µ–≤
3. **–†–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏**: VaR < 5% –≤ 95% —Å–ª—É—á–∞–µ–≤

### –¢–∏–ø—ã Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TB
    A[–¢–∏–ø—ã Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π] --> B[–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏]
    A --> C[–ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏]
    A --> D[–ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏]
    A --> E[–ë—É—Ç—Å—Ç—Ä–∞–ø —Å–∏–º—É–ª—è—Ü–∏–∏]
    
    B --> B1[–ò—Å–ø–æ–ª—å–∑—É—é—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è<br/>Normal, t-distribution, Mixture]
    B --> B2[‚ö° –ë—ã—Å—Ç—Ä—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è]
    B --> B3[‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö]
    B --> B4[üìä –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã]
    B --> B5[üéØ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏]
    
    C --> C1[–ò—Å–ø–æ–ª—å–∑—É—é—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ<br/>Bootstrap, Permutation]
    C --> C2[‚úÖ –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ]
    C --> C3[üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è]
    C --> C4[üìà –°–æ—Ö—Ä–∞–Ω—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö]
    C --> C5[üîÑ –ù–µ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π]
    
    D --> D1[–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö<br/>GARCH, Copula]
    D --> D2[‚öñÔ∏è –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å—é]
    D --> D3[‚úÖ –ù–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ]
    D --> D4[üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏]
    D --> D5[üìä –°–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è]
    
    E --> E1[–°–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º<br/>Block Bootstrap]
    E --> E2[‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö]
    E --> E3[‚úÖ –•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤]
    E --> E4[üìä –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è]
    E --> E5[‚ö° –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å]
    
    style A fill:#e3f2fd
    style B fill:#ffcdd2
    style C fill:#fff3e0
    style D fill:#c8e6c9
    style E fill:#4caf50
```

#### 1. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –ë—ã—Å—Ç—Ä—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- –¢—Ä–µ–±—É—é—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö

#### 2. –ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

#### 3. –ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏

- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å—é
- –ù–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ

#### 4. –ë—É—Ç—Å—Ç—Ä–∞–ø —Å–∏–º—É–ª—è—Ü–∏–∏

- –°–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
- –•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### 1.1 –ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏

### üìà –ü—Ä–æ—Ü–µ—Å—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ] --> B[–í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è]
    B --> C[–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
    B --> D[t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
    B --> E[–°–º–µ—à–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è]
    
    C --> F[–†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤<br/>mean, std]
    D --> G[–ü–æ–¥–≥–æ–Ω–∫–∞ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è<br/>df, loc, scale]
    E --> H[–ü–æ–¥–≥–æ–Ω–∫–∞ GMM<br/>n_components, weights]
    
    F --> I[–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    G --> I
    H --> I
    
    I --> J[–¶–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–π]
    J --> K[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π<br/>np.random.normal/t.rvs/gmm.sample]
    
    K --> L[–†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏<br/>cumprod(1 + returns) - 1]
    L --> M[–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞]
    
    M --> N[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean/std * sqrt(252)]
    M --> O[–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞<br/>calculate_max_drawdown]
    M --> P[–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å<br/>cumulative_return]
    
    N --> Q[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏]
    O --> Q
    P --> Q
    
    Q --> R{–í—Å–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã?}
    R -->|–ù–µ—Ç| J
    R -->|–î–∞| S[–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    
    S --> T[–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫]
    S --> U[–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã]
    S --> V[–ö–≤–∞–Ω—Ç–∏–ª–∏ –∏ VaR]
    
    T --> W[–û—Ü–µ–Ω–∫–∞ —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    U --> W
    V --> W
    
    W --> X{–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–æ–±–∞—Å—Ç–Ω–∞?}
    X -->|–î–∞| Y[‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é]
    X -->|–ù–µ—Ç| Z[‚ùå –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏]
    
    Z --> AA[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è]
    AA --> BB[–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    BB --> B
    
    style A fill:#e3f2fd
    style I fill:#fff3e0
    style S fill:#c8e6c9
    style Y fill:#4caf50
    style Z fill:#ff9800
```

**–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**

```python
def normal_monte_carlo(returns, n_simulations=10000, time_horizon=252):
    """
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.01 –¥–ª—è 1%).
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 30 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ)
        –í–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫ –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥ (252 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        - 756 –¥–Ω–µ–π = 3 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)  # 0.1% —Å—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, 2% –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    >>> simulations = normal_monte_carlo(returns, n_simulations=5000, time_horizon=252)
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"95% –∫–≤–∞–Ω—Ç–∏–ª—å –ø—Ä–æ—Å–∞–¥–∫–∏: {simulations['max_drawdown'].quantile(0.95):.2f}")
    
    Notes:
    ------
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ —Å–ª–µ–¥—É—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ mean/std * sqrt(252) –¥–ª—è –≥–æ–¥–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –æ—Ç –ø–∏–∫–∞
    - –î–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å >= 10000 —Å–∏–º—É–ª—è—Ü–∏–π
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    mean_return = np.mean(returns)  # –°—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    std_return = np.std(returns, ddof=1)  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–Ω–µ—Å–º–µ—â–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞)
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        # loc=mean_return, scale=std_return
        random_returns = np.random.normal(mean_return, std_return, time_horizon)
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: (1 + r1) * (1 + r2) * ... * (1 + rn) - 1
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)  # –ì–æ–¥–æ–≤–æ–π Sharpe
        max_drawdown = calculate_max_drawdown(random_returns)  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # 0.1% —Å—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, 2% –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
normal_simulations = normal_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
    time_horizon=252          # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
)
```

**–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–µ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**

```python
def t_distribution_monte_carlo(returns, n_simulations=10000, time_horizon=252):
    """
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –°—Ç—å—é–¥–µ–Ω—Ç–∞
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π —Å "—Ç—è–∂–µ–ª—ã–º–∏ —Ö–≤–æ—Å—Ç–∞–º–∏",
    —á—Ç–æ –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 50 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ç–µ–ø–µ–Ω–µ–π —Å–≤–æ–±–æ–¥—ã.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–æ–≥–Ω–∞—Ç—å t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫ –¥–∞–Ω–Ω—ã–º
        
    Examples:
    ---------
    >>> import numpy as np
    >>> from scipy import stats
    >>> # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å "—Ç—è–∂–µ–ª—ã–º–∏ —Ö–≤–æ—Å—Ç–∞–º–∏"
    >>> returns = stats.t.rvs(df=3, loc=0.001, scale=0.02, size=1000)
    >>> simulations = t_distribution_monte_carlo(returns, n_simulations=5000, time_horizon=252)
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–°—Ç–µ–ø–µ–Ω–∏ —Å–≤–æ–±–æ–¥—ã: {stats.t.fit(returns)[0]:.2f}")
    
    Notes:
    ------
    - t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Å —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    - –°—Ç–µ–ø–µ–Ω–∏ —Å–≤–æ–±–æ–¥—ã (df) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç "—Ç—è–∂–µ—Å—Ç—å —Ö–≤–æ—Å—Ç–æ–≤" —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    - –ü—Ä–∏ df -> ‚àû t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É
    - –ü—Ä–∏ df < 3 –¥–∏—Å–ø–µ—Ä—Å–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
    - –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥–æ–Ω—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: df, loc, scale
    """
    from scipy import stats
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    try:
        # –ü–æ–¥–≥–æ–Ω–∫–∞ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: df (—Å—Ç–µ–ø–µ–Ω–∏ —Å–≤–æ–±–æ–¥—ã), loc (—Å–º–µ—â–µ–Ω–∏–µ), scale (–º–∞—Å—à—Ç–∞–±)
    df, loc, scale = stats.t.fit(returns)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        if df <= 0 or scale <= 0:
            raise ValueError("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–≥–Ω–∞—Ç—å –≤–∞–ª–∏–¥–Ω–æ–µ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫ –¥–∞–Ω–Ω—ã–º")
            
    except Exception as e:
        raise ValueError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: {str(e)}")
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        # df - —Å—Ç–µ–ø–µ–Ω–∏ —Å–≤–æ–±–æ–¥—ã, loc - —Å—Ä–µ–¥–Ω–µ–µ, scale - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
        random_returns = stats.t.rvs(df, loc=loc, scale=scale, size=time_horizon)
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(random_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
t_simulations = t_distribution_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252          # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
)
```

**–°–º–µ—à–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**

```python
def mixture_monte_carlo(returns, n_simulations=10000, time_horizon=252, n_components=3):
    """
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å–æ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏ (Gaussian Mixture Model)
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–º–µ—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    —Å–ª–æ–∂–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∞—Å–∏–º–º–µ—Ç—Ä–∏—é.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ GMM.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    n_components : int, default=3
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Å–º–µ—à–∞–Ω–Ω–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 2: –ü—Ä–æ—Å—Ç–∞—è –±–∏–º–æ–¥–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å (–±—ã—á–∏–π/–º–µ–¥–≤–µ–∂–∏–π —Ä—ã–Ω–æ–∫)
        - 3: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (–±—ã—á–∏–π/–±–æ–∫–æ–≤–æ–π/–º–µ–¥–≤–µ–∂–∏–π)
        - 4-5: –°–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
        - 6+: –û—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—é)
        
        –í–ª–∏—è–µ—Ç –Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –∏ –≤—Ä–µ–º—è –ø–æ–¥–≥–æ–Ω–∫–∏.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ n_components < 1
        –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–æ–≥–Ω–∞—Ç—å GMM –∫ –¥–∞–Ω–Ω—ã–º
        
    Examples:
    ---------
    >>> import numpy as np
    >>> # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
    >>> returns = np.concatenate([
    ...     np.random.normal(0.002, 0.01, 300),  # –ë—ã—á–∏–π —Ä—ã–Ω–æ–∫
    ...     np.random.normal(-0.001, 0.015, 200),  # –ú–µ–¥–≤–µ–∂–∏–π —Ä—ã–Ω–æ–∫
    ...     np.random.normal(0.0005, 0.005, 500)   # –ë–æ–∫–æ–≤–æ–π —Ä—ã–Ω–æ–∫
    ... ])
    >>> simulations = mixture_monte_carlo(returns, n_components=3, n_simulations=5000)
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: 3")
    
    Notes:
    ------
    - GMM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–µ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    - –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —Ä–µ–∂–∏–º—ã
    - –ë–æ–ª—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ = –±–æ–ª–µ–µ –≥–∏–±–∫–∞—è –º–æ–¥–µ–ª—å, –Ω–æ —Ä–∏—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç EM-–∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    - random_state=42 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """
    from sklearn.mixture import GaussianMixture
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if n_components < 1:
        raise ValueError("n_components –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 1")
    
    try:
        # –ü–æ–¥–≥–æ–Ω–∫–∞ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (Gaussian Mixture Model)
        # n_components - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤ —Å–º–µ—Å–∏
        # random_state - –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    gmm = GaussianMixture(n_components=n_components, random_state=42)
        
        # –ü–æ–¥–≥–æ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ –∫ –¥–∞–Ω–Ω—ã–º (—Ç—Ä–µ–±—É–µ—Ç 2D –º–∞—Å—Å–∏–≤)
    gmm.fit(returns.reshape(-1, 1))
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ–¥–≥–æ–Ω–∫–∏
        if not gmm.converged_:
            raise ValueError("GMM –Ω–µ —Å–æ—à–µ–ª—Å—è –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ –∫ –¥–∞–Ω–Ω—ã–º")
            
    except Exception as e:
        raise ValueError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ GMM: {str(e)}")
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        # sample() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (samples, labels), –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ samples
        random_returns = gmm.sample(time_horizon)[0].flatten()
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(random_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
mixture_simulations = mixture_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    n_components=3            # 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–±—ã—á–∏–π/–±–æ–∫–æ–≤–æ–π/–º–µ–¥–≤–µ–∂–∏–π)
)
```

### 1.2 –ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏

### üîÑ –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ] --> B[–í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏]
    B --> C[–ë—É—Ç—Å—Ç—Ä–∞–ø —Å–∏–º—É–ª—è—Ü–∏–∏]
    B --> D[–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏]
    
    C --> E[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±—É—Ç—Å—Ç—Ä–∞–ø–∞<br/>block_size = 5<br/>n_simulations = 10,000]
    D --> F[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫<br/>n_simulations = 10,000<br/>time_horizon = 252]
    
    E --> G[–¶–∏–∫–ª –±—É—Ç—Å—Ç—Ä–∞–ø —Å–∏–º—É–ª—è—Ü–∏–π]
    G --> H[–°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö<br/>block_start = random.randint]
    H --> I[–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –±–ª–æ–∫–∞<br/>block = data[start:start+size]]
    I --> J[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ –∫ –≤—ã–±–æ—Ä–∫–µ<br/>bootstrap_returns.extend(block)]
    
    J --> K{–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –Ω—É–∂–Ω–∞—è –¥–ª–∏–Ω–∞?<br/>len(bootstrap_returns) >= time_horizon}
    K -->|–ù–µ—Ç| H
    K -->|–î–∞| L[–û–±—Ä–µ–∑–∫–∞ –¥–æ –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω—ã<br/>bootstrap_returns[:time_horizon]]
    
    F --> M[–¶–∏–∫–ª –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π]
    M --> N[–°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö<br/>np.random.permutation(returns)]
    N --> O[–û–±—Ä–µ–∑–∫–∞ –¥–æ –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω—ã<br/>permuted_returns[:time_horizon]]
    
    L --> P[–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞]
    O --> P
    
    P --> Q[–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å<br/>cumprod(1 + returns) - 1]
    P --> R[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean/std * sqrt(252)]
    P --> S[–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞<br/>calculate_max_drawdown]
    
    Q --> T[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    R --> T
    S --> T
    
    T --> U{–í—Å–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã?}
    U -->|–ù–µ—Ç| G
    U -->|–ù–µ—Ç| M
    U -->|–î–∞| V[–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    
    V --> W[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏]
    V --> X[–û—Ü–µ–Ω–∫–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏]
    V --> Y[–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã]
    
    W --> Z[–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–º—É–ª—è—Ü–∏–π]
    X --> Z
    Y --> Z
    
    Z --> AA{–°–∏–º—É–ª—è—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ?}
    AA -->|–î–∞| BB[‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    AA -->|–ù–µ—Ç| CC[‚ùå –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã]
    
    CC --> DD[–ò–∑–º–µ–Ω–µ–Ω–∏–µ block_size]
    CC --> EE[–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º—É–ª—è—Ü–∏–π]
    DD --> G
    EE --> G
    
    style A fill:#e3f2fd
    style G fill:#fff3e0
    style M fill:#fff3e0
    style V fill:#c8e6c9
    style BB fill:#4caf50
    style CC fill:#ff9800
```

**–ë—É—Ç—Å—Ç—Ä–∞–ø —Å–∏–º—É–ª—è—Ü–∏–∏:**

```python
def bootstrap_monte_carlo(returns, n_simulations=10000, time_horizon=252, block_size=5):
    """
    –ë—É—Ç—Å—Ç—Ä–∞–ø Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å –±–ª–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–æ–π
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–ª–æ—á–Ω—ã–π –±—É—Ç—Å—Ç—Ä–∞–ø –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    –∏ –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –±—É—Ç—Å—Ç—Ä–∞–ø –≤—ã–±–æ—Ä–∫–∏.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –±—É—Ç—Å—Ç—Ä–∞–ø –≤—ã–±–æ—Ä–∫–∏.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    block_size : int, default=5
        –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –¥–ª—è –±—É—Ç—Å—Ç—Ä–∞–ø –≤—ã–±–æ—Ä–∫–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 1: –ü—Ä–æ—Å—Ç–æ–π –±—É—Ç—Å—Ç—Ä–∞–ø (—Ç–µ—Ä—è–µ—Ç –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é)
        - 3-5: –ö–æ—Ä–æ—Ç–∫–∏–µ –±–ª–æ–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é)
        - 10-20: –°—Ä–µ–¥–Ω–∏–µ –±–ª–æ–∫–∏ (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –≥–∏–±–∫–æ—Å—Ç—å—é)
        - 50+: –î–ª–∏–Ω–Ω—ã–µ –±–ª–æ–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã)
        
        –í–ª–∏—è–µ—Ç –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ block_size <= 0
        –ï—Å–ª–∏ block_size >= len(returns)
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)
    >>> simulations = bootstrap_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252, 
    ...     block_size=10
    ... )
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞: 10 –¥–Ω–µ–π")
    
    Notes:
    ------
    - –ë–ª–æ—á–Ω—ã–π –±—É—Ç—Å—Ç—Ä–∞–ø —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –≤ –¥–∞–Ω–Ω—ã—Ö
    - –ë–æ–ª—å—à–∏–π block_size –ª—É—á—à–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    - –ú–µ–Ω—å—à–∏–π block_size –¥–∞–µ—Ç –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –≤ –≤—ã–±–æ—Ä–∫–µ
    - –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π block_size –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
    - –ú–µ—Ç–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if block_size <= 0:
        raise ValueError("block_size –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if block_size >= len(returns):
        raise ValueError("block_size –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –¥–ª–∏–Ω—ã returns")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ numpy array –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    returns = np.array(returns)
    
    simulations = []
    
    for i in range(n_simulations):
        # –°–æ–∑–¥–∞–Ω–∏–µ –±—É—Ç—Å—Ç—Ä–∞–ø –≤—ã–±–æ—Ä–∫–∏ —Å –±–ª–æ–∫–∞–º–∏
        bootstrap_returns = []
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω—ã
        while len(bootstrap_returns) < time_horizon:
            # –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –±–ª–æ–∫–∞
            # –£—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ –±–ª–æ–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞
            max_start = len(returns) - block_size
            if max_start < 0:
                raise ValueError("block_size –±–æ–ª—å—à–µ –¥–ª–∏–Ω—ã returns")
            
            block_start = np.random.randint(0, max_start + 1)
            block = returns[block_start:block_start + block_size]
            bootstrap_returns.extend(block)
        
        # –û–±—Ä–µ–∑–∫–∞ –¥–æ –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω—ã
        bootstrap_returns = np.array(bootstrap_returns[:time_horizon])
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + bootstrap_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(bootstrap_returns) / np.std(bootstrap_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(bootstrap_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': bootstrap_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
bootstrap_simulations = bootstrap_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±—É—Ç—Å—Ç—Ä–∞–ø –≤—ã–±–æ—Ä–∫–∏
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    block_size=5              # –ë–ª–æ–∫–∏ –ø–æ 5 –¥–Ω–µ–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
)
```

**–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏:**

```python
def permutation_monte_carlo(returns, n_simulations=10000, time_horizon=252):
    """
    –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
    —Å–∏–º—É–ª—è—Ü–∏–π –±–µ–∑ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏, –Ω–æ —Ç–µ—Ä—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 50 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        –ï—Å–ª–∏ time_horizon > len(returns), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—è –¥–ª–∏–Ω–∞ returns.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)
    >>> simulations = permutation_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252
    ... )
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–î–ª–∏–Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏: {len(returns)}")
    
    Notes:
    ------
    - –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑—Ä—É—à–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
    - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
    - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∏–ø–æ—Ç–µ–∑ –æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
    - –ú–µ–Ω–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ numpy array –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    returns = np.array(returns)
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –¥–ª–∏–Ω—ã –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
    actual_horizon = min(time_horizon, len(returns))
    
    simulations = []
    
    for i in range(n_simulations):
        # –°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
        # np.random.permutation —Å–æ–∑–¥–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫—É –º–∞—Å—Å–∏–≤–∞
        permuted_returns = np.random.permutation(returns)[:actual_horizon]
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + permuted_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(permuted_returns) / np.std(permuted_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(permuted_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': permuted_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
permutation_simulations = permutation_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252          # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥ (–∏–ª–∏ –≤—Å—è –¥–ª–∏–Ω–∞ returns)
)
```

### 1.3 –ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏

### üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ] --> B[–í—ã–±–æ—Ä –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞]
    B --> C[GARCH —Å–∏–º—É–ª—è—Ü–∏–∏]
    B --> D[Copula —Å–∏–º—É–ª—è—Ü–∏–∏]
    
    C --> E[–ü–æ–¥–≥–æ–Ω–∫–∞ GARCH –º–æ–¥–µ–ª–∏<br/>arch_model(returns, vol='Garch', p=1, q=1)]
    D --> F[–ü–æ–¥–≥–æ–Ω–∫–∞ –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π<br/>gaussian_kde(returns)]
    
    E --> G[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ GARCH<br/>omega, alpha, beta]
    F --> H[–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø—É–ª—ã<br/>gaussian_copula]
    
    G --> I[–¶–∏–∫–ª GARCH —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    H --> J[–¶–∏–∫–ª Copula —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    
    I --> K[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏<br/>GARCH(omega, alpha, beta)]
    K --> L[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π<br/>returns = volatility * random_normal]
    
    J --> M[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö<br/>uniform_vars = np.random.uniform]
    M --> N[–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–ø—É–ª—É<br/>returns = inverse_cdf(uniform_vars)]
    
    L --> O[–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞]
    N --> O
    
    O --> P[–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å<br/>cumprod(1 + returns) - 1]
    O --> Q[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean/std * sqrt(252)]
    O --> R[–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞<br/>calculate_max_drawdown]
    O --> S[–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å<br/>rolling_std(returns)]
    
    P --> T[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    Q --> T
    R --> T
    S --> T
    
    T --> U{–í—Å–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã?}
    U -->|–ù–µ—Ç| I
    U -->|–ù–µ—Ç| J
    U -->|–î–∞| V[–ê–Ω–∞–ª–∏–∑ –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    
    V --> W[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏]
    V --> X[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏]
    V --> Y[–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è]
    
    W --> Z[–û—Ü–µ–Ω–∫–∞ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞]
    X --> Z
    Y --> Z
    
    Z --> AA{–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω?}
    AA -->|–î–∞| BB[‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    AA -->|–ù–µ—Ç| CC[‚ùå –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏]
    
    CC --> DD[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GARCH –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤<br/>p, q, vol]
    CC --> EE[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Copula –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤<br/>marginal distributions]
    DD --> E
    EE --> F
    
    style A fill:#e3f2fd
    style C fill:#c8e6c9
    style D fill:#fff3e0
    style V fill:#f3e5f5
    style BB fill:#4caf50
    style CC fill:#ff9800
```

**GARCH —Å–∏–º—É–ª—è—Ü–∏–∏:**

```python
def garch_monte_carlo(returns, n_simulations=10000, time_horizon=252, p=1, q=1, vol='Garch'):
    """
    GARCH Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GARCH (Generalized Autoregressive Conditional Heteroskedasticity) –º–æ–¥–µ–ª—å
    –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω—è—é—â–µ–π—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ GARCH –º–æ–¥–µ–ª–∏.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ GARCH –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    p : int, default=1
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–≥–æ–≤ ARCH (—É—Å–ª–æ–≤–Ω–∞—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å).
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è GARCH(1,1) –º–æ–¥–µ–ª—å
        - 2: GARCH(2,1) —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º ARCH –ª–∞–≥–æ–º
        - 3+: –°–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—é)
        
    q : int, default=1
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–≥–æ–≤ GARCH (—É—Å–ª–æ–≤–Ω–∞—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å).
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è GARCH(1,1) –º–æ–¥–µ–ª—å
        - 2: GARCH(1,2) —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º GARCH –ª–∞–≥–æ–º
        - 3+: –°–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—é)
        
    vol : str, default='Garch'
        –¢–∏–ø –º–æ–¥–µ–ª–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
        - 'Garch': –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è GARCH –º–æ–¥–µ–ª—å
        - 'EGARCH': Exponential GARCH (—É—á–∏—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏—é)
        - 'GJR-GARCH': Glosten-Jagannathan-Runkle GARCH
        - 'TGARCH': Threshold GARCH
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ p < 0 –∏–ª–∏ q < 0
        –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–æ–≥–Ω–∞—Ç—å GARCH –º–æ–¥–µ–ª—å –∫ –¥–∞–Ω–Ω—ã–º
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)
    >>> simulations = garch_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252,
    ...     p=1, q=1, vol='Garch'
    ... )
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"GARCH –º–æ–¥–µ–ª—å: GARCH(1,1)")
    
    Notes:
    ------
    - GARCH –º–æ–¥–µ–ª–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã p –∏ q –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏
    - –ë–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è p,q –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—é
    - EGARCH –∏ GJR-GARCH –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ arch: pip install arch
    """
    from arch import arch_model
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if p < 0 or q < 0:
        raise ValueError("p –∏ q –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏")
    
    try:
    # –ü–æ–¥–≥–æ–Ω–∫–∞ GARCH –º–æ–¥–µ–ª–∏
        # vol - —Ç–∏–ø –º–æ–¥–µ–ª–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        # p - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ARCH –ª–∞–≥–æ–≤
        # q - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ GARCH –ª–∞–≥–æ–≤
        model = arch_model(returns, vol=vol, p=p, q=q)
        fitted_model = model.fit(disp='off')  # –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–≤–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ–¥–≥–æ–Ω–∫–∏
        if not fitted_model.convergence_flag:
            raise ValueError("GARCH –º–æ–¥–µ–ª—å –Ω–µ —Å–æ—à–ª–∞—Å—å –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ")
            
    except Exception as e:
        raise ValueError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ GARCH –º–æ–¥–µ–ª–∏: {str(e)}")
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        try:
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π —Å GARCH –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å—é
            # method='simulation' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Monte Carlo –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
        simulated_returns = fitted_model.forecast(horizon=time_horizon, method='simulation')
        
            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
            # mean —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        random_returns = simulated_returns.mean.iloc[-1].values
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if len(random_returns) != time_horizon:
                raise ValueError("–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π")
            
        except Exception as e:
            # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
            mean_return = np.mean(returns)
            std_return = np.std(returns)
            random_returns = np.random.normal(mean_return, std_return, time_horizon)
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(random_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
garch_simulations = garch_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ GARCH
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    p=1,                      # 1 ARCH –ª–∞–≥
    q=1,                      # 1 GARCH –ª–∞–≥
    vol='Garch'              # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è GARCH –º–æ–¥–µ–ª—å
)
```

**Copula —Å–∏–º—É–ª—è—Ü–∏–∏:**

```python
def copula_monte_carlo(returns, n_simulations=10000, time_horizon=252, copula_type='gaussian'):
    """
    Copula Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ø—É–ª—ã –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏,
    —Å–æ—Ö—Ä–∞–Ω—è—è –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ –∫–æ–ø—É–ª—ã.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–æ–ø—É–ª—ã.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    copula_type : str, default='gaussian'
        –¢–∏–ø –∫–æ–ø—É–ª—ã –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
        - 'gaussian': –ì–∞—É—Å—Å–æ–≤–∞ –∫–æ–ø—É–ª–∞ (–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
        - 't': t-–∫–æ–ø—É–ª–∞ (—Ö–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
        - 'clayton': –ö–ª–µ–π—Ç–æ–Ω –∫–æ–ø—É–ª–∞ (–Ω–∏–∂–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
        - 'gumbel': –ì—É–º–±–µ–ª—å –∫–æ–ø—É–ª–∞ (–≤–µ—Ä—Ö–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
        - 'frank': –§—Ä–∞–Ω–∫ –∫–æ–ø—É–ª–∞ (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ copula_type –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–æ–≥–Ω–∞—Ç—å –∫–æ–ø—É–ª—É –∫ –¥–∞–Ω–Ω—ã–º
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)
    >>> simulations = copula_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252,
    ...     copula_type='gaussian'
    ... )
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–¢–∏–ø –∫–æ–ø—É–ª—ã: Gaussian")
    
    Notes:
    ------
    - –ö–æ–ø—É–ª—ã —Ä–∞–∑–¥–µ–ª—è—é—Ç –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - –ì–∞—É—Å—Å–æ–≤–∞ –∫–æ–ø—É–ª–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–∏–Ω–µ–π–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - t-–∫–æ–ø—É–ª–∞ –ª—É—á—à–µ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç —Ö–≤–æ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - –ê—Ä—Ö–∏–º–µ–¥–æ–≤—ã –∫–æ–ø—É–ª—ã (Clayton, Gumbel, Frank) –¥–ª—è –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ scipy
    """
    from scipy.stats import gaussian_kde
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if copula_type not in ['gaussian', 't', 'clayton', 'gumbel', 'frank']:
        raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø –∫–æ–ø—É–ª—ã: {copula_type}")
    
    try:
        # –ü–æ–¥–≥–æ–Ω–∫–∞ –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é KDE
        # Gaussian KDE —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫—É—é –æ—Ü–µ–Ω–∫—É –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
    kde = gaussian_kde(returns)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ KDE
        if kde.covariance_factor <= 0:
            raise ValueError("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω–æ–µ KDE")
            
    except Exception as e:
        raise ValueError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π: {str(e)}")
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        try:
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ KDE
            # resample() –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –≤—ã–±–æ—Ä–∫–∏ –∏–∑ KDE
        random_returns = kde.resample(time_horizon).flatten()
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if len(random_returns) != time_horizon:
                raise ValueError("–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π")
            
        except Exception as e:
            # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
            mean_return = np.mean(returns)
            std_return = np.std(returns)
            random_returns = np.random.normal(mean_return, std_return, time_horizon)
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(random_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
copula_simulations = copula_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–≥–æ–Ω–∫–∏ –∫–æ–ø—É–ª—ã
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    copula_type='gaussian'    # –ì–∞—É—Å—Å–æ–≤–∞ –∫–æ–ø—É–ª–∞ –¥–ª—è –ª–∏–Ω–µ–π–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
)
```

### 4. –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚ö° –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Monte Carlo

```mermaid
graph TD
    A[–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ] --> B[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤]
    B --> C[–û–±–≤–∞–ª —Ä—ã–Ω–∫–∞<br/>volatility_multiplier: 3.0<br/>return_shift: -0.1]
    B --> D[–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å<br/>volatility_multiplier: 2.0<br/>return_shift: 0.0]
    B --> E[–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å<br/>volatility_multiplier: 0.5<br/>return_shift: 0.0]
    B --> F[–†–µ–∂–∏–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏<br/>n_regimes: 3]
    
    C --> G[–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è<br/>stressed_returns = apply_stress_scenario]
    D --> G
    E --> G
    F --> H[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤<br/>GaussianMixture(n_components=3)]
    
    G --> I[–¶–∏–∫–ª —Å—Ç—Ä–µ—Å—Å-—Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    H --> J[–¶–∏–∫–ª —Ä–µ–∂–∏–º–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    
    I --> K[–°–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ –∏–∑ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö<br/>np.random.choice(stressed_returns)]
    J --> L[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–æ–≤<br/>regime_sequence = gmm.sample]
    L --> M[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞<br/>regime_returns = returns[regime]]
    
    K --> N[–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Å—Ç—Ä–µ—Å—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è]
    M --> N
    
    N --> O[–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å<br/>cumprod(1 + returns) - 1]
    N --> P[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean/std * sqrt(252)]
    N --> Q[–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞<br/>calculate_max_drawdown]
    N --> R[–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å<br/>P(return < 0)]
    
    O --> S[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º]
    P --> S
    Q --> S
    R --> S
    
    S --> T{–í—Å–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã?}
    T -->|–ù–µ—Ç| I
    T -->|–ù–µ—Ç| J
    T -->|–î–∞| U[–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–µ—Å—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    
    U --> V[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤<br/>crash vs high_vol vs low_vol vs regimes]
    U --> W[–û—Ü–µ–Ω–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏<br/>performance under stress]
    U --> X[–†–∞—Å—á–µ—Ç VaR –∏ ES –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è]
    
    V --> Y[–û—Ü–µ–Ω–∫–∞ —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    W --> Y
    X --> Y
    
    Y --> Z{–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å?}
    Z -->|–î–∞| AA[‚úÖ –†–æ–±–∞—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è]
    Z -->|–ù–µ—Ç| BB[‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞]
    
    BB --> CC[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    BB --> DD[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤]
    CC --> EE[–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    DD --> EE
    EE --> B
    
    style A fill:#e3f2fd
    style C fill:#ffcdd2
    style D fill:#fff3e0
    style E fill:#e8f5e8
    style F fill:#f3e5f5
    style AA fill:#4caf50
    style BB fill:#ff9800
```

**–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

```python
def stress_test_monte_carlo(returns, n_simulations=10000, time_horizon=252, 
                          stress_scenarios=None):
    """
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    
    –í—ã–ø–æ–ª–Ω—è–µ—Ç Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    stress_scenarios : dict, optional
        –°–ª–æ–≤–∞—Ä—å —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        –ï—Å–ª–∏ None, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è:
        {
            'scenario_name': {
                'volatility_multiplier': float,  # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
                'return_shift': float,           # –°–¥–≤–∏–≥ —Å—Ä–µ–¥–Ω–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
                'tail_risk_multiplier': float    # –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ö–≤–æ—Å—Ç–æ–≤–æ–≥–æ —Ä–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            }
        }
        
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
        - 'market_crash': volatility_multiplier=3.0, return_shift=-0.1
        - 'high_volatility': volatility_multiplier=2.0, return_shift=0.0
        - 'low_volatility': volatility_multiplier=0.5, return_shift=0.0
        - 'extreme_tail': volatility_multiplier=4.0, return_shift=-0.15, tail_risk_multiplier=2.0
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.
        –ö–ª—é—á–∏ - –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –∑–Ω–∞—á–µ–Ω–∏—è - pd.DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DataFrame –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ stress_scenarios —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        
    Examples:
    ---------
    >>> import numpy as np
    >>> returns = np.random.normal(0.001, 0.02, 1000)
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
    >>> custom_scenarios = {
    ...     'crash_2008': {'volatility_multiplier': 4.0, 'return_shift': -0.2},
    ...     'covid_2020': {'volatility_multiplier': 3.5, 'return_shift': -0.15}
    ... }
    >>> 
    >>> stress_simulations = stress_test_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252,
    ...     stress_scenarios=custom_scenarios
    ... )
    >>> 
    >>> print(f"–°—Ü–µ–Ω–∞—Ä–∏–∏: {list(stress_simulations.keys())}")
    >>> print(f"Crash 2008 Sharpe: {stress_simulations['crash_2008']['sharpe'].mean():.2f}")
    
    Notes:
    ------
    - –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    - volatility_multiplier > 1 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    - return_shift < 0 —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å–¥–≤–∏–≥ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    - tail_risk_multiplier —É—Å–∏–ª–∏–≤–∞–µ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∫—Ä–∏–∑–∏—Å–∞—Ö
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
    if stress_scenarios is None:
        stress_scenarios = {
            'market_crash': {
                'volatility_multiplier': 3.0, 
                'return_shift': -0.1,
                'description': '–û–±–≤–∞–ª —Ä—ã–Ω–∫–∞: –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–µ–≥–∞—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å'
            },
            'high_volatility': {
                'volatility_multiplier': 2.0, 
                'return_shift': 0.0,
                'description': '–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫'
            },
            'low_volatility': {
                'volatility_multiplier': 0.5, 
                'return_shift': 0.0,
                'description': '–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫'
            },
            'extreme_tail': {
                'volatility_multiplier': 4.0, 
                'return_shift': -0.15,
                'tail_risk_multiplier': 2.0,
                'description': '–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Ö–≤–æ—Å—Ç—ã: –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –∏ –ø–æ—Ç–µ—Ä–∏'
            }
        }
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    for scenario_name, params in stress_scenarios.items():
        if 'volatility_multiplier' not in params or 'return_shift' not in params:
            raise ValueError(f"–°—Ü–µ–Ω–∞—Ä–∏–π {scenario_name} –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å volatility_multiplier –∏ return_shift")
        
        if params['volatility_multiplier'] <= 0:
            raise ValueError(f"volatility_multiplier –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ {scenario_name} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ numpy array –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    returns = np.array(returns)
    
    all_simulations = {}
    
    for scenario_name, scenario_params in stress_scenarios.items():
        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
        stressed_returns = apply_stress_scenario(returns, scenario_params)
        
        # –°–∏–º—É–ª—è—Ü–∏–∏ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è
        simulations = []
        for i in range(n_simulations):
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –∏–∑ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            random_returns = np.random.choice(stressed_returns, size=time_horizon, replace=True)
            
            # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
            cumulative_return = np.prod(1 + random_returns) - 1
            
            # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
            sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
            max_drawdown = calculate_max_drawdown(random_returns)
            
            simulations.append({
                'cumulative_return': cumulative_return,
                'sharpe': sharpe,
                'max_drawdown': max_drawdown,
                'returns': random_returns
            })
        
        all_simulations[scenario_name] = pd.DataFrame(simulations)
    
    return all_simulations

def apply_stress_scenario(returns, scenario_params):
    """
    –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º
    
    Parameters:
    -----------
    returns : array-like
        –ò—Å—Ö–æ–¥–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        
    scenario_params : dict
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:
        - volatility_multiplier: float - –º–Ω–æ–∂–∏—Ç–µ–ª—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        - return_shift: float - —Å–¥–≤–∏–≥ —Å—Ä–µ–¥–Ω–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        - tail_risk_multiplier: float, optional - –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ö–≤–æ—Å—Ç–æ–≤–æ–≥–æ —Ä–∏—Å–∫–∞
        
    Returns:
    --------
    array
        –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
    """
    returns = np.array(returns)
    
    # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    volatility_multiplier = scenario_params['volatility_multiplier']
    return_shift = scenario_params['return_shift']
    tail_risk_multiplier = scenario_params.get('tail_risk_multiplier', 1.0)
    
    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–¥–≤–∏–≥–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    stressed_returns = returns + return_shift
    
    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    mean_return = np.mean(stressed_returns)
    stressed_returns = (stressed_returns - mean_return) * volatility_multiplier + mean_return
    
    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ö–≤–æ—Å—Ç–æ–≤–æ–≥–æ —Ä–∏—Å–∫–∞ (—É—Å–∏–ª–µ–Ω–∏–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
    if tail_risk_multiplier > 1.0:
        # –ù–∞—Ö–æ–¥–∏–º —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ 2 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π)
        std_return = np.std(stressed_returns)
        extreme_mask = np.abs(stressed_returns - mean_return) > 2 * std_return
        
        # –£—Å–∏–ª–∏–≤–∞–µ–º —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        stressed_returns[extreme_mask] = (
            (stressed_returns[extreme_mask] - mean_return) * tail_risk_multiplier + mean_return
        )
    
    return stressed_returns

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
custom_scenarios = {
    'financial_crisis_2008': {
        'volatility_multiplier': 4.0, 
        'return_shift': -0.2,
        'tail_risk_multiplier': 2.5,
        'description': '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫—Ä–∏–∑–∏—Å 2008: —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å'
    },
    'covid_crash_2020': {
        'volatility_multiplier': 3.5, 
        'return_shift': -0.15,
        'tail_risk_multiplier': 2.0,
        'description': 'COVID-19 –∫—Ä–∞—Ö 2020: –±—ã—Å—Ç—Ä—ã–µ –∏ –≥–ª—É–±–æ–∫–∏–µ –ø–æ—Ç–µ—Ä–∏'
    },
    'dotcom_bubble': {
        'volatility_multiplier': 2.5, 
        'return_shift': -0.12,
        'description': '–ö—Ä–∞—Ö –¥–æ—Ç–∫–æ–º–æ–≤: —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—É–∑—ã—Ä—å'
    }
}

stress_simulations = stress_test_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    stress_scenarios=custom_scenarios  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
)
```

**–†–µ–∂–∏–º–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏:**

```python
def regime_monte_carlo(returns, n_simulations=10000, time_horizon=252, n_regimes=3):
    """
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å —Ä–µ–∂–∏–º–∞–º–∏ —Ä—ã–Ω–∫–∞
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gaussian Mixture Model –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
    –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–º—É–ª—è—Ü–∏–π —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏.
    
    Parameters:
    -----------
    returns : array-like
        –ú–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ decimal.
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 200 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤.
        –¢–∏–ø: numpy.ndarray, pandas.Series –∏–ª–∏ list
        
    n_simulations : int, default=10000
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Monte Carlo –∞–Ω–∞–ª–∏–∑–∞.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - –ú–∏–Ω–∏–º—É–º: 1000 (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 10000 (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        - –ú–∞–∫—Å–∏–º—É–º: 100000 (–¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏)
        
    time_horizon : int, default=252
        –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è—Ö.
        –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 252 –¥–Ω—è = 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
        - 126 –¥–Ω–µ–π = 6 –º–µ—Å—è—Ü–µ–≤
        - 504 –¥–Ω—è = 2 –≥–æ–¥–∞
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
        
    n_regimes : int, default=3
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 2: –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å (–±—ã—á–∏–π/–º–µ–¥–≤–µ–∂–∏–π —Ä—ã–Ω–æ–∫)
        - 3: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (–±—ã—á–∏–π/–±–æ–∫–æ–≤–æ–π/–º–µ–¥–≤–µ–∂–∏–π)
        - 4-5: –°–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
        - 6+: –û—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—é)
        
        –í–ª–∏—è–µ—Ç –Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Ä–µ–∂–∏–º–æ–≤.
        
    Returns:
    --------
    pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–ª–æ–Ω–∫–∏:
        - 'cumulative_return': float - –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥
        - 'sharpe': float - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (–≥–æ–¥–æ–≤–æ–π)
        - 'max_drawdown': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
        - 'returns': array - –º–∞—Å—Å–∏–≤ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        - 'regime_sequence': array - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ returns –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ n_simulations <= 0
        –ï—Å–ª–∏ time_horizon <= 0
        –ï—Å–ª–∏ n_regimes < 2
        –ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–æ–≥–Ω–∞—Ç—å GMM –∫ –¥–∞–Ω–Ω—ã–º
        
    Examples:
    ---------
    >>> import numpy as np
    >>> # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏
    >>> bull_market = np.random.normal(0.002, 0.01, 300)
    >>> bear_market = np.random.normal(-0.001, 0.015, 200)
    >>> sideways = np.random.normal(0.0005, 0.005, 500)
    >>> returns = np.concatenate([bull_market, bear_market, sideways])
    >>> 
    >>> simulations = regime_monte_carlo(
    ...     returns, 
    ...     n_simulations=5000, 
    ...     time_horizon=252,
    ...     n_regimes=3
    ... )
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {simulations['sharpe'].mean():.2f}")
    >>> print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∂–∏–º–æ–≤: 3")
    
    Notes:
    ------
    - GMM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—è–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ —Ä–µ–∂–∏–º—ã –≤ –¥–∞–Ω–Ω—ã—Ö
    - –ö–∞–∂–¥—ã–π —Ä–µ–∂–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —Å–≤–æ–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
    - –†–µ–∂–∏–º—ã –º–æ–≥—É—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —Ä—ã–Ω–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    - –ë–æ–ª—å—à–µ —Ä–µ–∂–∏–º–æ–≤ = –±–æ–ª–µ–µ –≥–∏–±–∫–∞—è –º–æ–¥–µ–ª—å, –Ω–æ —Ä–∏—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
    - random_state=42 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """
    from sklearn.mixture import GaussianMixture
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if len(returns) == 0:
        raise ValueError("–ú–∞—Å—Å–∏–≤ returns –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not all(isinstance(x, (int, float)) for x in returns):
        raise ValueError("–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã returns –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–≤—ã–º–∏")
    
    if n_simulations <= 0:
        raise ValueError("n_simulations –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if time_horizon <= 0:
        raise ValueError("time_horizon –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if n_regimes < 2:
        raise ValueError("n_regimes –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 2")
    
    try:
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Å –ø–æ–º–æ—â—å—é Gaussian Mixture Model
        # n_components - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∂–∏–º–æ–≤ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–º–µ—Å–∏)
        # random_state - –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    gmm = GaussianMixture(n_components=n_regimes, random_state=42)
        
        # –ü–æ–¥–≥–æ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ –∫ –¥–∞–Ω–Ω—ã–º (—Ç—Ä–µ–±—É–µ—Ç 2D –º–∞—Å—Å–∏–≤)
    gmm.fit(returns.reshape(-1, 1))
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ–¥–≥–æ–Ω–∫–∏
        if not gmm.converged_:
            raise ValueError("GMM –Ω–µ —Å–æ—à–µ–ª—Å—è –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ –∫ –¥–∞–Ω–Ω—ã–º")
            
    except Exception as e:
        raise ValueError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ–Ω–∫–µ GMM: {str(e)}")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ numpy array –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    returns = np.array(returns)
    
    # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    historical_regimes = gmm.predict(returns.reshape(-1, 1)).flatten()
    
    # –°–∏–º—É–ª—è—Ü–∏–∏
    simulations = []
    for i in range(n_simulations):
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∂–∏–º–æ–≤
        # sample() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (samples, labels), –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ labels
        regime_sequence = gmm.sample(time_horizon)[1].flatten()
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
        random_returns = []
        for regime in regime_sequence:
            # –ù–∞—Ö–æ–¥–∏–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            regime_returns = returns[historical_regimes == regime]
            
            if len(regime_returns) > 0:
                # –°–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ –∏–∑ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                random_returns.append(np.random.choice(regime_returns))
            else:
                # –ï—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â—É—é –≤—ã–±–æ—Ä–∫—É
                random_returns.append(np.random.choice(returns))
        
        random_returns = np.array(random_returns)
        
        # –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        cumulative_return = np.prod(1 + random_returns) - 1
        
        # –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        sharpe = np.mean(random_returns) / np.std(random_returns) * np.sqrt(252)
        max_drawdown = calculate_max_drawdown(random_returns)
        
        simulations.append({
            'cumulative_return': cumulative_return,
            'sharpe': sharpe,
            'max_drawdown': max_drawdown,
            'returns': random_returns,
            'regime_sequence': regime_sequence
        })
    
    return pd.DataFrame(simulations)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
returns = np.random.normal(0.001, 0.02, 1000)  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
regime_simulations = regime_monte_carlo(
    returns=returns,           # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    n_simulations=10000,      # 10,000 —Å–∏–º—É–ª—è—Ü–∏–π
    time_horizon=252,         # 1 —Ç–æ—Ä–≥–æ–≤—ã–π –≥–æ–¥
    n_regimes=3               # 3 —Ä–µ–∂–∏–º–∞ (–±—ã—á–∏–π/–±–æ–∫–æ–≤–æ–π/–º–µ–¥–≤–µ–∂–∏–π)
)
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### üìä –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ Monte Carlo] --> B[–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏]
    A --> C[–†–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏]
    A --> D[–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏]
    
    B --> B1[–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    B1 --> B11[–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ<br/>mean_sharpe]
    B1 --> B12[–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ<br/>std_sharpe]
    B1 --> B13[–ú–µ–¥–∏–∞–Ω–∞<br/>median_sharpe]
    B1 --> B14[–ö–≤–∞–Ω—Ç–∏–ª–∏<br/>q5, q25, q75, q95]
    B1 --> B15[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏<br/>std/mean]
    B1 --> B16[–ê—Å–∏–º–º–µ—Ç—Ä–∏—è –∏ —ç–∫—Å—Ü–µ—Å—Å<br/>skewness, kurtosis]
    
    B --> B2[–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã]
    B2 --> B21[90% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª<br/>alpha = 0.1]
    B2 --> B22[95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª<br/>alpha = 0.05]
    B2 --> B23[99% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª<br/>alpha = 0.01]
    B2 --> B24[t-—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ<br/>t.ppf(1-alpha/2, n-1)]
    
    C --> C1[Value at Risk - VaR]
    C1 --> C11[VaR 90%<br/>quantile(0.1)]
    C1 --> C12[VaR 95%<br/>quantile(0.05)]
    C1 --> C13[VaR 99%<br/>quantile(0.01)]
    C1 --> C14[VaR –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞<br/>sharpe_var]
    C1 --> C15[VaR –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏<br/>drawdown_var]
    C1 --> C16[VaR –¥–ª—è –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏<br/>return_var]
    
    C --> C2[Expected Shortfall - ES]
    C2 --> C21[ES 90%<br/>mean(returns <= VaR_90)]
    C2 --> C22[ES 95%<br/>mean(returns <= VaR_95)]
    C2 --> C23[ES 99%<br/>mean(returns <= VaR_99)]
    C2 --> C24[ES –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞<br/>sharpe_es]
    C2 --> C25[ES –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏<br/>drawdown_es]
    C2 --> C26[ES –¥–ª—è –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏<br/>return_es]
    
    D --> D1[–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞]
    D1 --> D11[–£—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞<br/>sharpe >= 1.0 AND drawdown >= -0.2]
    D1 --> D12[–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞<br/>success_condition.mean()]
    D1 --> D13[–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_successful]
    D1 --> D14[–°—Ä–µ–¥–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö<br/>avg_sharpe, avg_drawdown, avg_return]
    
    D --> D2[–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å]
    D2 --> D21[–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è<br/>initial_capital * (1 + cumulative_return)]
    D2 --> D22[–°—Ä–µ–¥–Ω—è—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å<br/>mean_final_value]
    D2 --> D23[–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å<br/>median_final_value]
    D2 --> D24[–ö–≤–∞–Ω—Ç–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏<br/>q5_final_value, q95_final_value]
    D2 --> D25[–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å<br/>P(final_value < initial_capital)]
    D2 --> D26[–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å<br/>P(final_value < 0.5 * initial_capital)]
    
    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style C fill:#fff3e0
    style D fill:#f3e5f5
```

### 1. –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**

```python
def calculate_distribution_metrics(simulations, metrics=['sharpe', 'max_drawdown', 'cumulative_return']):
    """
    –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
        –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: 'sharpe', 'max_drawdown', 'cumulative_return'
        
    metrics : list, default=['sharpe', 'max_drawdown', 'cumulative_return']
        –°–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'sharpe': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞
        - 'max_drawdown': –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
        - 'cumulative_return': –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
        - 'volatility': –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
        - 'calmar': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª–º–∞—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã return –∏ drawdown)
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —É–∫–∞–∑–∞–Ω–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏.
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {metric_name: {statistic_name: value}}
        
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏:
        - 'mean': –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        - 'std': –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
        - 'median': –ú–µ–¥–∏–∞–Ω–∞
        - 'q5', 'q25', 'q75', 'q95': –ö–≤–∞–Ω—Ç–∏–ª–∏ (5%, 25%, 75%, 95%)
        - 'coefficient_of_variation': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ (std/mean)
        - 'skewness': –ê—Å–∏–º–º–µ—Ç—Ä–∏—è (skewness)
        - 'kurtosis': –≠–∫—Å—Ü–µ—Å—Å (kurtosis)
        - 'min', 'max': –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        –ï—Å–ª–∏ metrics —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
        –ï—Å–ª–∏ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–≤–Ω—ã (std = 0)
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'sharpe': np.random.normal(1.0, 0.3, 1000),
    ...     'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
    >>> metrics = calculate_distribution_metrics(simulations)
    >>> print(f"–°—Ä–µ–¥–Ω–∏–π Sharpe: {metrics['sharpe']['mean']:.2f}")
    >>> print(f"95% –∫–≤–∞–Ω—Ç–∏–ª—å –ø—Ä–æ—Å–∞–¥–∫–∏: {metrics['max_drawdown']['q95']:.2f}")
    >>> 
    >>> # –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è Sharpe
    >>> sharpe_metrics = calculate_distribution_metrics(simulations, metrics=['sharpe'])
    >>> print(f"–ê—Å–∏–º–º–µ—Ç—Ä–∏—è Sharpe: {sharpe_metrics['sharpe']['skewness']:.2f}")
    
    Notes:
    ------
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å
    - –ê—Å–∏–º–º–µ—Ç—Ä–∏—è > 0 –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∞–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    - –≠–∫—Å—Ü–µ—Å—Å > 3 –æ–∑–Ω–∞—á–∞–µ—Ç "—Ç—è–∂–µ–ª—ã–µ —Ö–≤–æ—Å—Ç—ã" (–±–æ–ª—å—à–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
    - –ö–≤–∞–Ω—Ç–∏–ª–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –¥–æ–≤–µ—Ä–∏—è
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    available_metrics = simulations.columns.tolist()
    missing_metrics = [m for m in metrics if m not in available_metrics]
    if missing_metrics:
        raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏: {missing_metrics}. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available_metrics}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
    valid_metrics = ['sharpe', 'max_drawdown', 'cumulative_return', 'volatility', 'calmar']
    invalid_metrics = [m for m in metrics if m not in valid_metrics]
    if invalid_metrics:
        raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏: {invalid_metrics}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ: {valid_metrics}")
    
    results = {}
    
    for metric in metrics:
        if metric not in simulations.columns:
            continue
            
        data = simulations[metric].dropna()  # –£–¥–∞–ª—è–µ–º NaN –∑–Ω–∞—á–µ–Ω–∏—è
        
        if len(data) == 0:
            raise ValueError(f"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ {metric}")
        
    # –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        mean_val = data.mean()
        std_val = data.std()
        median_val = data.median()
    
    # –ö–≤–∞–Ω—Ç–∏–ª–∏
        q5 = data.quantile(0.05)
        q25 = data.quantile(0.25)
        q75 = data.quantile(0.75)
        q95 = data.quantile(0.95)
    
    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏
        cv = std_val / abs(mean_val) if mean_val != 0 else 0
    
    # –ê—Å–∏–º–º–µ—Ç—Ä–∏—è –∏ —ç–∫—Å—Ü–µ—Å—Å
        skewness = data.skew()
        kurtosis = data.kurtosis()
        
        # –ú–∏–Ω–∏–º—É–º –∏ –º–∞–∫—Å–∏–º—É–º
        min_val = data.min()
        max_val = data.max()
        
        results[metric] = {
            'mean': mean_val,
            'std': std_val,
            'median': median_val,
        'q5': q5,
        'q25': q25,
        'q75': q75,
        'q95': q95,
        'coefficient_of_variation': cv,
        'skewness': skewness,
            'kurtosis': kurtosis,
            'min': min_val,
            'max': max_val,
            'count': len(data)
        }
    
    return results

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'sharpe': np.random.normal(1.0, 0.3, 1000),
    'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
distribution_metrics = calculate_distribution_metrics(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    metrics=['sharpe', 'max_drawdown', 'cumulative_return']  # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
)
```

**–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:**

```python
def calculate_confidence_intervals(simulations, confidence_levels=[0.90, 0.95, 0.99], 
                                 metrics=['sharpe', 'max_drawdown', 'cumulative_return']):
    """
    –†–∞—Å—á–µ—Ç –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
        –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: 'sharpe', 'max_drawdown', 'cumulative_return'
        
    confidence_levels : list, default=[0.90, 0.95, 0.99]
        –°–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.90: 90% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (Œ± = 0.10)
        - 0.95: 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (Œ± = 0.05) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
        - 0.99: 99% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (Œ± = 0.01) - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
        - 0.50: 50% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–º–µ–∂–∫–≤–∞—Ä—Ç–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–∞—Ö)
        
        –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1).
        
    metrics : list, default=['sharpe', 'max_drawdown', 'cumulative_return']
        –°–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'sharpe': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞
        - 'max_drawdown': –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
        - 'cumulative_return': –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
        - 'volatility': –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
        - 'calmar': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª–º–∞—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏ –∏ —É—Ä–æ–≤–Ω—è –¥–æ–≤–µ—Ä–∏—è.
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {confidence_level: {metric: {'lower': value, 'upper': value}}}
        
        –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å_–¥–æ–≤–µ—Ä–∏—è-–º–µ—Ç—Ä–∏–∫–∞:
        - 'lower': –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
        - 'upper': –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
        - 'width': –®–∏—Ä–∏–Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (upper - lower)
        - 'center': –¶–µ–Ω—Ç—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ ((upper + lower) / 2)
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        –ï—Å–ª–∏ confidence_levels —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ metrics —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
        –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'sharpe': np.random.normal(1.0, 0.3, 1000),
    ...     'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    >>> intervals = calculate_confidence_intervals(simulations)
    >>> print(f"95% CI –¥–ª—è Sharpe: {intervals[0.95]['sharpe']['lower']:.2f} - {intervals[0.95]['sharpe']['upper']:.2f}")
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    >>> custom_intervals = calculate_confidence_intervals(
    ...     simulations, 
    ...     confidence_levels=[0.80, 0.95, 0.99],
    ...     metrics=['sharpe', 'cumulative_return']
    ... )
    >>> print(f"80% CI —à–∏—Ä–∏–Ω–∞: {custom_intervals[0.80]['sharpe']['width']:.2f}")
    
    Notes:
    ------
    - –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∏–∞–ø–∞–∑–æ–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å –∑–∞–¥–∞–Ω–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é
      –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏—Å—Ç–∏–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    - –ë–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –±–æ–ª—å—à—É—é –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å
    - 95% –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ 95% —Å–ª—É—á–∞–µ–≤ –∏—Å—Ç–∏–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    - –î–ª—è –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–≤–∞–Ω—Ç–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è
    for level in confidence_levels:
        if not (0 < level < 1):
            raise ValueError(f"–£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è {level} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1)")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    available_metrics = simulations.columns.tolist()
    missing_metrics = [m for m in metrics if m not in available_metrics]
    if missing_metrics:
        raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏: {missing_metrics}. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available_metrics}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
    valid_metrics = ['sharpe', 'max_drawdown', 'cumulative_return', 'volatility', 'calmar']
    invalid_metrics = [m for m in metrics if m not in valid_metrics]
    if invalid_metrics:
        raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏: {invalid_metrics}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ: {valid_metrics}")
    
    confidence_intervals = {}
    
    for level in confidence_levels:
        alpha = 1 - level
        lower_percentile = (alpha / 2) * 100
        upper_percentile = (1 - alpha / 2) * 100
        
        level_intervals = {}
        
        for metric in metrics:
            if metric not in simulations.columns:
                continue
                
            data = simulations[metric].dropna()
            
            if len(data) == 0:
                raise ValueError(f"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ {metric}")
            
            # –†–∞—Å—á–µ—Ç –∫–≤–∞–Ω—Ç–∏–ª–µ–π –¥–ª—è –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            lower_bound = data.quantile(lower_percentile / 100)
            upper_bound = data.quantile(upper_percentile / 100)
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            width = upper_bound - lower_bound
            center = (upper_bound + lower_bound) / 2
            
            level_intervals[metric] = {
                'lower': lower_bound,
                'upper': upper_bound,
                'width': width,
                'center': center,
                'level': level,
                'alpha': alpha
            }
        
        confidence_intervals[level] = level_intervals
    
    return confidence_intervals

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'sharpe': np.random.normal(1.0, 0.3, 1000),
    'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
confidence_intervals = calculate_confidence_intervals(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    confidence_levels=[0.90, 0.95, 0.99],  # –£—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    metrics=['sharpe', 'max_drawdown', 'cumulative_return']  # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
)
```

### 2. –†–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏

**Value at Risk (VaR):**

```python
def calculate_var_metrics(simulations, confidence_levels=[0.90, 0.95, 0.99], 
                         metrics=['sharpe', 'max_drawdown', 'cumulative_return']):
    """
    –†–∞—Å—á–µ—Ç Value at Risk (VaR) –º–µ—Ç—Ä–∏–∫ –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç Value at Risk –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
        –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: 'sharpe', 'max_drawdown', 'cumulative_return'
        
    confidence_levels : list, default=[0.90, 0.95, 0.99]
        –°–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ VaR.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.90: VaR 90% (10% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è)
        - 0.95: VaR 95% (5% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
        - 0.99: VaR 99% (1% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è) - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
        - 0.999: VaR 99.9% (0.1% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è) - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π
        
        –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1).
        
    metrics : list, default=['sharpe', 'max_drawdown', 'cumulative_return']
        –°–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ VaR.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'sharpe': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (VaR –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à–∏–π –æ–∂–∏–¥–∞–µ–º—ã–π Sharpe)
        - 'max_drawdown': –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (VaR –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à—É—é –æ–∂–∏–¥–∞–µ–º—É—é –ø—Ä–æ—Å–∞–¥–∫—É)
        - 'cumulative_return': –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (VaR –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö—É–¥—à—É—é –æ–∂–∏–¥–∞–µ–º—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å)
        - 'volatility': –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
        - 'calmar': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª–º–∞—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å VaR –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏ –∏ —É—Ä–æ–≤–Ω—è –¥–æ–≤–µ—Ä–∏—è.
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {confidence_level: {metric: var_value}}
        
        –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å_–¥–æ–≤–µ—Ä–∏—è-–º–µ—Ç—Ä–∏–∫–∞:
        - VaR –∑–Ω–∞—á–µ–Ω–∏–µ (–∫–≤–∞–Ω—Ç–∏–ª—å (1 - confidence_level))
        - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 'var_absolute' - –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ VaR
        - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 'exceedance_prob' - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è VaR
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        –ï—Å–ª–∏ confidence_levels —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ metrics —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
        –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ VaR
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'sharpe': np.random.normal(1.0, 0.3, 1000),
    ...     'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ VaR –º–µ—Ç—Ä–∏–∫–∏
    >>> var_metrics = calculate_var_metrics(simulations)
    >>> print(f"VaR 95% –¥–ª—è Sharpe: {var_metrics[0.95]['sharpe']:.2f}")
    >>> print(f"VaR 95% –¥–ª—è –ø—Ä–æ—Å–∞–¥–∫–∏: {var_metrics[0.95]['max_drawdown']:.2f}")
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    >>> custom_var = calculate_var_metrics(
    ...     simulations, 
    ...     confidence_levels=[0.80, 0.95, 0.99],
    ...     metrics=['sharpe', 'cumulative_return']
    ... )
    >>> print(f"VaR 80% –¥–ª—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: {custom_var[0.80]['cumulative_return']:.2f}")
    
    Notes:
    ------
    - VaR –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –æ–∂–∏–¥–∞–µ–º—É—é –ø–æ—Ç–µ—Ä—é —Å –∑–∞–¥–∞–Ω–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é
    - –î–ª—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: VaR 95% = –∫–≤–∞–Ω—Ç–∏–ª—å 5% (—Ö—É–¥—à–∏–µ 5% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
    - –î–ª—è –ø—Ä–æ—Å–∞–¥–∫–∏: VaR 95% = –∫–≤–∞–Ω—Ç–∏–ª—å 5% (—Ö—É–¥—à–∏–µ 5% –ø—Ä–æ—Å–∞–¥–æ–∫)
    - –î–ª—è Sharpe: VaR 95% = –∫–≤–∞–Ω—Ç–∏–ª—å 5% (—Ö—É–¥—à–∏–µ 5% –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –®–∞—Ä–ø–∞)
    - VaR –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ—Ç–µ—Ä—å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–≤–∞–Ω—Ç–∏–ª—è (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ES)
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è
    for level in confidence_levels:
        if not (0 < level < 1):
            raise ValueError(f"–£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è {level} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1)")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    available_metrics = simulations.columns.tolist()
    missing_metrics = [m for m in metrics if m not in available_metrics]
    if missing_metrics:
        raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏: {missing_metrics}. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available_metrics}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
    valid_metrics = ['sharpe', 'max_drawdown', 'cumulative_return', 'volatility', 'calmar']
    invalid_metrics = [m for m in metrics if m not in valid_metrics]
    if invalid_metrics:
        raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏: {invalid_metrics}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ: {valid_metrics}")
    
    var_metrics = {}
    
    for level in confidence_levels:
        # VaR —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –∫–≤–∞–Ω—Ç–∏–ª—å (1 - confidence_level)
        var_percentile = (1 - level) * 100
        
        level_var = {}
        
        for metric in metrics:
            if metric not in simulations.columns:
                continue
                
            data = simulations[metric].dropna()
            
            if len(data) == 0:
                raise ValueError(f"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ {metric}")
            
            # –†–∞—Å—á–µ—Ç VaR –∫–∞–∫ –∫–≤–∞–Ω—Ç–∏–ª—å
            var_value = data.quantile(var_percentile / 100)
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            var_absolute = abs(var_value)
            exceedance_prob = (data <= var_value).mean()
            
            level_var[metric] = {
                'var': var_value,
                'var_absolute': var_absolute,
                'exceedance_prob': exceedance_prob,
                'confidence_level': level,
                'percentile': var_percentile
            }
        
        var_metrics[level] = level_var
    
    return var_metrics

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'sharpe': np.random.normal(1.0, 0.3, 1000),
    'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ VaR –º–µ—Ç—Ä–∏–∫–∏
var_metrics = calculate_var_metrics(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    confidence_levels=[0.90, 0.95, 0.99],  # –£—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    metrics=['sharpe', 'max_drawdown', 'cumulative_return']  # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
)
```

**Expected Shortfall (ES):**

```python
def calculate_es_metrics(simulations, confidence_levels=[0.90, 0.95, 0.99], 
                        metrics=['sharpe', 'max_drawdown', 'cumulative_return']):
    """
    –†–∞—Å—á–µ—Ç Expected Shortfall (ES) –º–µ—Ç—Ä–∏–∫ –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç Expected Shortfall (Conditional Value at Risk, CVaR) –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö
    –º–µ—Ç—Ä–∏–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö –ø–æ—Ç–µ—Ä—å
    –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
        –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: 'sharpe', 'max_drawdown', 'cumulative_return'
        
    confidence_levels : list, default=[0.90, 0.95, 0.99]
        –°–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ES.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.90: ES 90% (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö 10% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
        - 0.95: ES 95% (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö 5% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
        - 0.99: ES 99% (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö 1% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤) - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π
        - 0.999: ES 99.9% (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö 0.1% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤) - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π
        
        –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1).
        
    metrics : list, default=['sharpe', 'max_drawdown', 'cumulative_return']
        –°–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ES.
        –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'sharpe': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ (ES –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π Sharpe –≤ —Ö—É–¥—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö)
        - 'max_drawdown': –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (ES –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é –ø—Ä–æ—Å–∞–¥–∫—É –≤ —Ö—É–¥—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö)
        - 'cumulative_return': –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (ES –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –≤ —Ö—É–¥—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö)
        - 'volatility': –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
        - 'calmar': –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ö–∞–ª–º–∞—Ä–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å ES –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏ –∏ —É—Ä–æ–≤–Ω—è –¥–æ–≤–µ—Ä–∏—è.
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {confidence_level: {metric: es_value}}
        
        –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å_–¥–æ–≤–µ—Ä–∏—è-–º–µ—Ç—Ä–∏–∫–∞:
        - ES –∑–Ω–∞—á–µ–Ω–∏–µ (—Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö)
        - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 'es_absolute' - –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ES
        - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 'tail_count' - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –≤ —Ö–≤–æ—Å—Ç–µ
        - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: 'tail_probability' - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Ö–≤–æ—Å—Ç
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        –ï—Å–ª–∏ confidence_levels —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        –ï—Å–ª–∏ metrics —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
        –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ES
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'sharpe': np.random.normal(1.0, 0.3, 1000),
    ...     'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ ES –º–µ—Ç—Ä–∏–∫–∏
    >>> es_metrics = calculate_es_metrics(simulations)
    >>> print(f"ES 95% –¥–ª—è Sharpe: {es_metrics[0.95]['sharpe']:.2f}")
    >>> print(f"ES 95% –¥–ª—è –ø—Ä–æ—Å–∞–¥–∫–∏: {es_metrics[0.95]['max_drawdown']:.2f}")
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    >>> custom_es = calculate_es_metrics(
    ...     simulations, 
    ...     confidence_levels=[0.80, 0.95, 0.99],
    ...     metrics=['sharpe', 'cumulative_return']
    ... )
    >>> print(f"ES 80% –¥–ª—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: {custom_es[0.80]['cumulative_return']:.2f}")
    
    Notes:
    ------
    - ES (Expected Shortfall) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
    - ES –≤—Å–µ–≥–¥–∞ –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω VaR –¥–ª—è —Ç–æ–≥–æ –∂–µ —É—Ä–æ–≤–Ω—è –¥–æ–≤–µ—Ä–∏—è
    - ES —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ—Ç–µ—Ä—å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ VaR (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç VaR)
    - ES –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –º–µ—Ä–∞ —Ä–∏—Å–∫–∞, —á–µ–º VaR
    - ES –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–≥—É–ª—è—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö (Basel III, Solvency II)
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π –¥–æ–≤–µ—Ä–∏—è
    for level in confidence_levels:
        if not (0 < level < 1):
            raise ValueError(f"–£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è {level} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1)")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    available_metrics = simulations.columns.tolist()
    missing_metrics = [m for m in metrics if m not in available_metrics]
    if missing_metrics:
        raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏: {missing_metrics}. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available_metrics}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
    valid_metrics = ['sharpe', 'max_drawdown', 'cumulative_return', 'volatility', 'calmar']
    invalid_metrics = [m for m in metrics if m not in valid_metrics]
    if invalid_metrics:
        raise ValueError(f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏: {invalid_metrics}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ: {valid_metrics}")
    
    es_metrics = {}
    
    for level in confidence_levels:
        # ES —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—É–¥—à–∏—Ö (1 - confidence_level) —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
        tail_probability = 1 - level
        
        level_es = {}
        
        for metric in metrics:
            if metric not in simulations.columns:
                continue
                
            data = simulations[metric].dropna()
            
            if len(data) == 0:
                raise ValueError(f"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ {metric}")
            
            # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ –¥–ª—è —Ö–≤–æ—Å—Ç–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            threshold = data.quantile(tail_probability)
            
            # –ù–∞—Ö–æ–¥–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –≤ —Ö–≤–æ—Å—Ç–µ (—Ö—É–¥—à–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
            tail_data = data[data <= threshold]
            
            if len(tail_data) == 0:
                # –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –≤ —Ö–≤–æ—Å—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                es_value = data.min()
                tail_count = 1
            else:
                # ES –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö–≤–æ—Å—Ç–µ
                es_value = tail_data.mean()
                tail_count = len(tail_data)
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            es_absolute = abs(es_value)
            actual_tail_prob = tail_count / len(data)
            
            level_es[metric] = {
                'es': es_value,
                'es_absolute': es_absolute,
                'tail_count': tail_count,
                'tail_probability': actual_tail_prob,
                'threshold': threshold,
                'confidence_level': level
            }
        
        es_metrics[level] = level_es
    
    return es_metrics

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'sharpe': np.random.normal(1.0, 0.3, 1000),
    'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ ES –º–µ—Ç—Ä–∏–∫–∏
es_metrics = calculate_es_metrics(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    confidence_levels=[0.90, 0.95, 0.99],  # –£—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è
    metrics=['sharpe', 'max_drawdown', 'cumulative_return']  # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
)
```

### 3. –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞:**

```python
def calculate_success_probability(simulations, min_sharpe=1.0, max_drawdown=-0.2, 
                                 min_return=0.0, max_volatility=0.3, custom_conditions=None):
    """
    –†–∞—Å—á–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞ –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±—É–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ
    –∑–∞–¥–∞–Ω–Ω—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–π.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏: 'sharpe', 'max_drawdown', 'cumulative_return'
        
    min_sharpe : float, default=1.0
        –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.5: –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ (–ø—Ä–∏–µ–º–ª–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
        - 1.0: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ (—Ö–æ—Ä–æ—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
        - 1.5: –í—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ (–æ—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
        - 2.0: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ (–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
        
    max_drawdown : float, default=-0.2
        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - -0.05: –û—á–µ–Ω—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (-5%)
        - -0.10: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (-10%)
        - -0.20: –£–º–µ—Ä–µ–Ω–Ω—ã–π (-20%)
        - -0.30: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (-30%)
        
        –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º.
        
    min_return : float, default=0.0
        –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.0: –ë–µ–∑ –ø–æ—Ç–µ—Ä—å (0%)
        - 0.05: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (5%)
        - 0.10: –•–æ—Ä–æ—à–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (10%)
        - 0.20: –û—Ç–ª–∏—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (20%)
        
    max_volatility : float, default=0.3
        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.10: –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (10%)
        - 0.20: –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (20%)
        - 0.30: –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (30%)
        - 0.50: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (50%)
        
        –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ 'volatility'.
        
    custom_conditions : dict, optional
        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {column: condition}.
        –ü—Ä–∏–º–µ—Ä—ã:
        - {'sharpe': lambda x: x >= 1.5}
        - {'max_drawdown': lambda x: x >= -0.15}
        - {'cumulative_return': lambda x: x >= 0.1}
        
        –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞.
        
        –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'success_probability': float - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ (0-1)
        - 'n_successful': int - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        - 'n_total': int - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π
        - 'success_rate': float - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        
        –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π:
        - 'avg_sharpe_successful': float - —Å—Ä–µ–¥–Ω–∏–π Sharpe —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        - 'avg_drawdown_successful': float - —Å—Ä–µ–¥–Ω—è—è –ø—Ä–æ—Å–∞–¥–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        - 'avg_return_successful': float - —Å—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        - 'avg_volatility_successful': float - —Å—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
        
        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'success_confidence_interval': tuple - –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞
        - 'failure_analysis': dict - –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –Ω–µ—É–¥–∞—á
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
        –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å–ª–æ–≤–∏–π –Ω–µ–≤–∞–ª–∏–¥–Ω—ã
        –ï—Å–ª–∏ custom_conditions —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'sharpe': np.random.normal(1.0, 0.3, 1000),
    ...     'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞
    >>> success = calculate_success_probability(simulations)
    >>> print(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞: {success['success_probability']:.2%}")
    >>> 
    >>> # –°—Ç—Ä–æ–≥–∏–µ —É—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞
    >>> strict_success = calculate_success_probability(
    ...     simulations,
    ...     min_sharpe=1.5,
    ...     max_drawdown=-0.1,
    ...     min_return=0.1
    ... )
    >>> print(f"–°—Ç—Ä–æ–≥–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞: {strict_success['success_probability']:.2%}")
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è
    >>> custom_success = calculate_success_probability(
    ...     simulations,
    ...     custom_conditions={
    ...         'sharpe': lambda x: x >= 1.2,
    ...         'cumulative_return': lambda x: x >= 0.08
    ...     }
    ... )
    >>> print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞: {custom_success['success_probability']:.2%}")
    
    Notes:
    ------
    - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ª—é —Å–∏–º—É–ª—è—Ü–∏–π, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏—è–º
    - –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –±–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    - –ê–Ω–∞–ª–∏–∑ –Ω–µ—É–¥–∞—á –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–≤–∞–ª–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    required_columns = ['sharpe', 'max_drawdown', 'cumulative_return']
    missing_columns = [col for col in required_columns if col not in simulations.columns]
    if missing_columns:
        raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∏: {missing_columns}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É—Å–ª–æ–≤–∏–π
    if max_drawdown > 0:
        raise ValueError("max_drawdown –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º")
    
    if min_return < 0:
        raise ValueError("min_return –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º")
    
    if max_volatility <= 0:
        raise ValueError("max_volatility –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º")
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π —É—Å–ø–µ—Ö–∞
    if custom_conditions is not None:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è
        success_condition = pd.Series([True] * len(simulations), index=simulations.index)
        
        for column, condition in custom_conditions.items():
            if column not in simulations.columns:
                raise ValueError(f"–ö–æ–ª–æ–Ω–∫–∞ {column} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ simulations")
            
            if not callable(condition):
                raise ValueError(f"–£—Å–ª–æ–≤–∏–µ –¥–ª—è {column} –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏–µ–π")
            
            success_condition &= simulations[column].apply(condition)
    else:
        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
        success_condition = (
            (simulations['sharpe'] >= min_sharpe) & 
            (simulations['max_drawdown'] >= max_drawdown) &
            (simulations['cumulative_return'] >= min_return)
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
        if 'volatility' in simulations.columns:
            success_condition &= (simulations['volatility'] <= max_volatility)
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    n_total = len(simulations)
    n_successful = success_condition.sum()
    success_probability = success_condition.mean()
    success_rate = success_probability * 100
    
    # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–º—É–ª—è—Ü–∏–π
    successful_simulations = simulations[success_condition]
    
    if len(successful_simulations) > 0:
        avg_sharpe = successful_simulations['sharpe'].mean()
        avg_drawdown = successful_simulations['max_drawdown'].mean()
        avg_return = successful_simulations['cumulative_return'].mean()
        
        if 'volatility' in simulations.columns:
            avg_volatility = successful_simulations['volatility'].mean()
        else:
            avg_volatility = None
    else:
        avg_sharpe = 0
        avg_drawdown = 0
        avg_return = 0
        avg_volatility = None
    
    # –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞ (95%)
    from scipy.stats import beta
    alpha = n_successful + 1
    beta_param = n_total - n_successful + 1
    ci_lower = beta.ppf(0.025, alpha, beta_param)
    ci_upper = beta.ppf(0.975, alpha, beta_param)
    
    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –Ω–µ—É–¥–∞—á
    failed_simulations = simulations[~success_condition]
    failure_analysis = {}
    
    if len(failed_simulations) > 0:
        failure_analysis = {
            'sharpe_too_low': (failed_simulations['sharpe'] < min_sharpe).mean(),
            'drawdown_too_high': (failed_simulations['max_drawdown'] < max_drawdown).mean(),
            'return_too_low': (failed_simulations['cumulative_return'] < min_return).mean()
        }
        
        if 'volatility' in simulations.columns:
            failure_analysis['volatility_too_high'] = (failed_simulations['volatility'] > max_volatility).mean()
    
    result = {
        'success_probability': success_probability,
        'n_successful': n_successful,
        'n_total': n_total,
        'success_rate': success_rate,
        'avg_sharpe_successful': avg_sharpe,
        'avg_drawdown_successful': avg_drawdown,
        'avg_return_successful': avg_return,
        'success_confidence_interval': (ci_lower, ci_upper),
        'failure_analysis': failure_analysis
    }
    
    if avg_volatility is not None:
        result['avg_volatility_successful'] = avg_volatility
    
    return result

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'sharpe': np.random.normal(1.0, 0.3, 1000),
    'max_drawdown': np.random.normal(-0.1, 0.05, 1000),
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —É—Å–ø–µ—Ö–∞
success_metrics = calculate_success_probability(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    min_sharpe=1.0,          # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Sharpe
    max_drawdown=-0.2,       # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
    min_return=0.0,          # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    max_volatility=0.3       # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
)
```

**–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:**

```python
def calculate_profitability_metrics(simulations, initial_capital=100000, 
                                  target_return=0.1, risk_free_rate=0.02):
    """
    –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
    
    –í—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    
    Parameters:
    -----------
    simulations : pd.DataFrame
        DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π.
        –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É 'cumulative_return' —Å –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–º–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—è–º–∏.
        
    initial_capital : float, default=100000
        –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 10000: –ù–µ–±–æ–ª—å—à–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å ($10,000)
        - 100000: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å ($100,000)
        - 1000000: –ö—Ä—É–ø–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å ($1,000,000)
        - 10000000: –ò–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å ($10,000,000)
        
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º.
        
    target_return : float, default=0.1
        –¶–µ–ª–µ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.05: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Ü–µ–ª—å (5%)
        - 0.10: –£–º–µ—Ä–µ–Ω–Ω–∞—è —Ü–µ–ª—å (10%)
        - 0.15: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ü–µ–ª—å (15%)
        - 0.20: –û—á–µ–Ω—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ü–µ–ª—å (20%)
        
    risk_free_rate : float, default=0.02
        –ë–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏.
        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - 0.01: –ù–∏–∑–∫–∞—è —Å—Ç–∞–≤–∫–∞ (1%)
        - 0.02: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (2%)
        - 0.03: –í—ã—Å–æ–∫–∞—è —Å—Ç–∞–≤–∫–∞ (3%)
        - 0.05: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Å—Ç–∞–≤–∫–∞ (5%)
        
    Returns:
    --------
    dict
        –°–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏.
        
        –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:
        - 'mean_final_value': float - —Å—Ä–µ–¥–Ω—è—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        - 'median_final_value': float - –º–µ–¥–∏–∞–Ω–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        - 'std_final_value': float - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        - 'min_final_value': float - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        - 'max_final_value': float - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        
        –ö–≤–∞–Ω—Ç–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏:
        - 'q5_final_value': float - 5% –∫–≤–∞–Ω—Ç–∏–ª—å (VaR 95%)
        - 'q25_final_value': float - 25% –∫–≤–∞–Ω—Ç–∏–ª—å (Q1)
        - 'q75_final_value': float - 75% –∫–≤–∞–Ω—Ç–∏–ª—å (Q3)
        - 'q95_final_value': float - 95% –∫–≤–∞–Ω—Ç–∏–ª—å (VaR 5%)
        
        –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–æ–≤:
        - 'loss_probability': float - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å < –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª)
        - 'target_achievement_probability': float - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        - 'significant_loss_probability': float - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å (>50%)
        - 'doubling_probability': float - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–¥–≤–æ–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞
        
        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
        - 'excess_return': float - —Å—Ä–µ–¥–Ω—è—è –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
        - 'value_at_risk_95': float - VaR 95% –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        - 'expected_shortfall_95': float - ES 95% –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        
    Raises:
    -------
    ValueError
        –ï—Å–ª–∏ simulations –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç 'cumulative_return'
        –ï—Å–ª–∏ initial_capital <= 0
        –ï—Å–ª–∏ target_return < 0
        –ï—Å–ª–∏ risk_free_rate < 0
        
    Examples:
    ---------
    >>> import pandas as pd
    >>> import numpy as np
    >>> 
    >>> # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    >>> simulations = pd.DataFrame({
    ...     'cumulative_return': np.random.normal(0.15, 0.1, 1000)
    ... })
    >>> 
    >>> # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
    >>> profitability = calculate_profitability_metrics(simulations)
    >>> print(f"–°—Ä–µ–¥–Ω—è—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${profitability['mean_final_value']:,.2f}")
    >>> print(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä—å: {profitability['loss_probability']:.2%}")
    >>> 
    >>> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    >>> custom_profitability = calculate_profitability_metrics(
    ...     simulations,
    ...     initial_capital=50000,
    ...     target_return=0.12,
    ...     risk_free_rate=0.025
    ... )
    >>> print(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 12%: {custom_profitability['target_achievement_probability']:.2%}")
    
    Notes:
    ------
    - –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å = initial_capital * (1 + cumulative_return)
    - –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å = —Å—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å - risk_free_rate
    - VaR –∏ ES —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
    - –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if simulations.empty:
        raise ValueError("DataFrame simulations –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º")
    
    if not isinstance(simulations, pd.DataFrame):
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å pandas DataFrame")
    
    if 'cumulative_return' not in simulations.columns:
        raise ValueError("simulations –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É 'cumulative_return'")
    
    if initial_capital <= 0:
        raise ValueError("initial_capital –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º")
    
    if target_return < 0:
        raise ValueError("target_return –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º")
    
    if risk_free_rate < 0:
        raise ValueError("risk_free_rate –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º")
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è
    final_values = initial_capital * (1 + simulations['cumulative_return'])
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    mean_final_value = final_values.mean()
    median_final_value = final_values.median()
    std_final_value = final_values.std()
    min_final_value = final_values.min()
    max_final_value = final_values.max()
    
    # –ö–≤–∞–Ω—Ç–∏–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    q5_final_value = final_values.quantile(0.05)
    q25_final_value = final_values.quantile(0.25)
    q75_final_value = final_values.quantile(0.75)
    q95_final_value = final_values.quantile(0.95)
    
    # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–æ–≤
    loss_probability = (final_values < initial_capital).mean()
    target_achievement_probability = (final_values >= initial_capital * (1 + target_return)).mean()
    significant_loss_probability = (final_values < initial_capital * 0.5).mean()
    doubling_probability = (final_values >= initial_capital * 2).mean()
    
    # –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    mean_return = simulations['cumulative_return'].mean()
    excess_return = mean_return - risk_free_rate
    
    # VaR –∏ ES –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    var_95 = final_values.quantile(0.05)
    es_95 = final_values[final_values <= var_95].mean()
    
    return {
        'mean_final_value': mean_final_value,
        'median_final_value': median_final_value,
        'std_final_value': std_final_value,
        'min_final_value': min_final_value,
        'max_final_value': max_final_value,
        'q5_final_value': q5_final_value,
        'q25_final_value': q25_final_value,
        'q75_final_value': q75_final_value,
        'q95_final_value': q95_final_value,
        'loss_probability': loss_probability,
        'target_achievement_probability': target_achievement_probability,
        'significant_loss_probability': significant_loss_probability,
        'doubling_probability': doubling_probability,
        'excess_return': excess_return,
        'value_at_risk_95': var_95,
        'expected_shortfall_95': es_95,
        'initial_capital': initial_capital,
        'target_return': target_return,
        'risk_free_rate': risk_free_rate
    }

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
simulations = pd.DataFrame({
    'cumulative_return': np.random.normal(0.15, 0.1, 1000)
})

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
profitability_metrics = calculate_profitability_metrics(
    simulations=simulations,  # DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å–∏–º—É–ª—è—Ü–∏–π
    initial_capital=100000,   # –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª $100,000
    target_return=0.1,        # –¶–µ–ª–µ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å 10%
    risk_free_rate=0.02       # –ë–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 2%
)
```

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### üìà –î–∞—à–±–æ—Ä–¥ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–†–µ–∑—É–ª—å—Ç–∞—Ç—ã Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π] --> B[–î–∞—à–±–æ—Ä–¥ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏]
    
    B --> C[–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è]
    C --> C1[–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞<br/>—Å –ª–∏–Ω–∏—è–º–∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ –∫–≤–∞–Ω—Ç–∏–ª–µ–π]
    C --> C2[–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏<br/>—Å –ª–∏–Ω–∏—è–º–∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ –∫–≤–∞–Ω—Ç–∏–ª–µ–π]
    C --> C3[–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏<br/>—Å –ª–∏–Ω–∏—è–º–∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –∏ –∫–≤–∞–Ω—Ç–∏–ª–µ–π]
    C --> C4[Q-Q –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏<br/>scipy.stats.probplot]
    
    B --> D[–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã]
    D --> D1[–ü—É—Ç–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏<br/>100 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π]
    D --> D2[–°—Ä–µ–¥–Ω–∏–π –ø—É—Ç—å<br/>mean_cumulative_returns]
    D --> D3[–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π<br/>histogram final_values]
    D --> D4[–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ—Ç—Ä–∏–∫<br/>scatter sharpe vs drawdown]
    D --> D5[–í—Ä–µ–º–µ–Ω–Ω–∞—è —ç–≤–æ–ª—é—Ü–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏<br/>rolling_volatility]
    
    B --> E[–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏]
    E --> E1[Box plot –º–µ—Ç—Ä–∏–∫<br/>—Å –≤—ã–±—Ä–æ—Å–∞–º–∏ –∏ –∫–≤–∞–Ω—Ç–∏–ª—è–º–∏]
    E --> E2[Violin plot —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π<br/>–ø–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏]
    E --> E3[–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞<br/>heatmap correlations]
    E --> E4[–ö—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è<br/>CDF –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏]
    
    B --> F[–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏]
    F --> F1[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏<br/>parametric vs nonparametric vs hybrid]
    F --> F2[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è<br/>crash vs high_vol vs low_vol]
    F --> F3[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤<br/>90% vs 95% vs 99%]
    F --> F4[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ VaR –∏ ES<br/>—Ä–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è]
    
    C1 --> G[–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã]
    C2 --> G
    C3 --> G
    C4 --> G
    D1 --> G
    D2 --> G
    D3 --> G
    D4 --> G
    D5 --> G
    E1 --> G
    E2 --> G
    E3 --> G
    E4 --> G
    F1 --> G
    F2 --> G
    F3 --> G
    F4 --> G
    
    G --> H[Zoom –∏ Pan —Ñ—É–Ω–∫—Ü–∏–∏]
    G --> I[–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º]
    G --> J[–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã]
    G --> K[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤—ã—Ö —Å—Ö–µ–º]
    G --> L[–ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤]
    
    H --> M[–§–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥]
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N[–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π]
    M --> O[–í—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π]
    M --> P[–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤]
    M --> Q[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π]
    
    N --> R[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
    O --> R
    P --> R
    Q --> R
    
    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style G fill:#fff3e0
    style R fill:#4caf50
```

### 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```python
def visualize_monte_carlo_distributions(simulations, save_path=None):
    """–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π"""
    import matplotlib.pyplot as plt
    import seaborn as sns
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è
    plt.style.use('seaborn-v0_8')
    sns.set_palette("husl")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))
    
    # 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞
    axes[0, 0].hist(simulations['sharpe'], bins=50, alpha=0.7, edgecolor='black')
    axes[0, 0].axvline(simulations['sharpe'].mean(), color='red', linestyle='--', 
                      label=f'–°—Ä–µ–¥–Ω–µ–µ: {simulations["sharpe"].mean():.2f}')
    axes[0, 0].axvline(simulations['sharpe'].quantile(0.05), color='orange', linestyle='--', 
                      label=f'5% –∫–≤–∞–Ω—Ç–∏–ª—å: {simulations["sharpe"].quantile(0.05):.2f}')
    axes[0, 0].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞')
    axes[0, 0].set_xlabel('–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞')
    axes[0, 0].set_ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
    axes[0, 0].legend()
    axes[0, 0].grid(True)
    
    # 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏
    axes[0, 1].hist(simulations['max_drawdown'], bins=50, alpha=0.7, edgecolor='black')
    axes[0, 1].axvline(simulations['max_drawdown'].mean(), color='red', linestyle='--', 
                      label=f'–°—Ä–µ–¥–Ω–µ–µ: {simulations["max_drawdown"].mean():.2f}')
    axes[0, 1].axvline(simulations['max_drawdown'].quantile(0.95), color='orange', linestyle='--', 
                      label=f'95% –∫–≤–∞–Ω—Ç–∏–ª—å: {simulations["max_drawdown"].quantile(0.95):.2f}')
    axes[0, 1].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏')
    axes[0, 1].set_xlabel('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞')
    axes[0, 1].set_ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
    axes[0, 1].legend()
    axes[0, 1].grid(True)
    
    # 3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    axes[1, 0].hist(simulations['cumulative_return'], bins=50, alpha=0.7, edgecolor='black')
    axes[1, 0].axvline(simulations['cumulative_return'].mean(), color='red', linestyle='--', 
                      label=f'–°—Ä–µ–¥–Ω–µ–µ: {simulations["cumulative_return"].mean():.2f}')
    axes[1, 0].axvline(simulations['cumulative_return'].quantile(0.05), color='orange', linestyle='--', 
                      label=f'5% –∫–≤–∞–Ω—Ç–∏–ª—å: {simulations["cumulative_return"].quantile(0.05):.2f}')
    axes[1, 0].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏')
    axes[1, 0].set_xlabel('–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å')
    axes[1, 0].set_ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
    axes[1, 0].legend()
    axes[1, 0].grid(True)
    
    # 4. Q-Q –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞
    from scipy import stats
    stats.probplot(simulations['sharpe'], dist="norm", plot=axes[1, 1])
    axes[1, 1].set_title('Q-Q –≥—Ä–∞—Ñ–∏–∫ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –®–∞—Ä–ø–∞')
    axes[1, 1].grid(True)
    
    plt.tight_layout()
    
    if save_path:
        plt.savefig(save_path, dpi=300, bbox_inches='tight')
    
    plt.show()

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
visualize_monte_carlo_distributions(simulations, save_path='monte_carlo_distributions.png')
```

### 2. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã

```python
def visualize_monte_carlo_paths(simulations, n_paths=100, save_path=None):
    """–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π"""
    import matplotlib.pyplot as plt
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª—è
    plt.style.use('seaborn-v0_8')
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))
    
    # 1. –ü—É—Ç–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    for i in range(min(n_paths, len(simulations))):
        returns = simulations.iloc[i]['returns']
        cumulative_returns = (1 + returns).cumprod()
        axes[0, 0].plot(cumulative_returns, alpha=0.1, color='blue')
    
    # –°—Ä–µ–¥–Ω–∏–π –ø—É—Ç—å
    mean_returns = np.mean([sim['returns'] for sim in simulations.iloc[:n_paths]], axis=0)
    mean_cumulative_returns = (1 + mean_returns).cumprod()
    axes[0, 0].plot(mean_cumulative_returns, color='red', linewidth=2, label='–°—Ä–µ–¥–Ω–∏–π –ø—É—Ç—å')
    
    axes[0, 0].set_title('–ü—É—Ç–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏')
    axes[0, 0].set_xlabel('–í—Ä–µ–º—è')
    axes[0, 0].set_ylabel('–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å')
    axes[0, 0].legend()
    axes[0, 0].grid(True)
    
    # 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    final_values = (1 + simulations['cumulative_return']).values
    axes[0, 1].hist(final_values, bins=50, alpha=0.7, edgecolor='black')
    axes[0, 1].axvline(final_values.mean(), color='red', linestyle='--', 
                      label=f'–°—Ä–µ–¥–Ω–µ–µ: {final_values.mean():.2f}')
    axes[0, 1].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π')
    axes[0, 1].set_xlabel('–§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ')
    axes[0, 1].set_ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
    axes[0, 1].legend()
    axes[0, 1].grid(True)
    
    # 3. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –º–µ—Ç—Ä–∏–∫–∞–º–∏
    axes[1, 0].scatter(simulations['sharpe'], simulations['max_drawdown'], alpha=0.5)
    axes[1, 0].set_xlabel('–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞')
    axes[1, 0].set_ylabel('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞')
    axes[1, 0].set_title('–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è: Sharpe vs Max Drawdown')
    axes[1, 0].grid(True)
    
    # 4. –í—Ä–µ–º–µ–Ω–Ω–∞—è —ç–≤–æ–ª—é—Ü–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    volatility_paths = []
    for i in range(min(n_paths, len(simulations))):
        returns = simulations.iloc[i]['returns']
        rolling_vol = pd.Series(returns).rolling(30).std()
        volatility_paths.append(rolling_vol)
    
    mean_volatility = np.mean(volatility_paths, axis=0)
    axes[1, 1].plot(mean_volatility, color='red', linewidth=2, label='–°—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å')
    axes[1, 1].set_title('–í—Ä–µ–º–µ–Ω–Ω–∞—è —ç–≤–æ–ª—é—Ü–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏')
    axes[1, 1].set_xlabel('–í—Ä–µ–º—è')
    axes[1, 1].set_ylabel('–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å')
    axes[1, 1].legend()
    axes[1, 1].grid(True)
    
    plt.tight_layout()
    
    if save_path:
        plt.savefig(save_path, dpi=300, bbox_inches='tight')
    
    plt.show()

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
visualize_monte_carlo_paths(simulations, n_paths=100, save_path='monte_carlo_paths.png')
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

### ü§ñ –ü–∞–π–ø–ª–∞–π–Ω –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

```mermaid
graph TD
    A[–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ] --> B[MonteCarloPipeline]
    B --> C[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤]
    
    C --> D[–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏<br/>normal, t-distribution, mixture]
    C --> E[–ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏<br/>bootstrap, permutation]
    C --> F[–ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏<br/>GARCH, Copula]
    C --> G[–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ<br/>crash, high_vol, low_vol, regimes]
    
    D --> H[–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–π<br/>n_simulations = 10,000]
    E --> H
    F --> H
    G --> H
    
    H --> I[–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞]
    I --> J[–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean/std * sqrt(252)]
    I --> K[–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞<br/>calculate_max_drawdown]
    I --> L[–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å<br/>cumprod(1 + returns) - 1]
    I --> M[VaR –∏ ES<br/>quantile, expected_shortfall]
    
    J --> N[–°–±–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º]
    K --> N
    L --> N
    M --> N
    
    N --> O[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞]
    O --> P[–°–≤–æ–¥–∫–∞ –ø–æ –º–µ—Ç–æ–¥–∞–º]
    O --> Q[–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã]
    O --> R[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
    
    P --> S[–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞<br/>mean_sharpe]
    P --> T[–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ<br/>std_sharpe]
    P --> U[–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π<br/>success_rate]
    P --> V[VaR 95%<br/>var_95]
    P --> W[ES 95%<br/>es_95]
    
    Q --> X[–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–º—É–ª—è—Ü–∏–π]
    Q --> Y[–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤]
    Q --> Z[–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã]
    
    R --> AA[–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏]
    AA --> BB[–û—Ç–ª–∏—á–Ω–∞—è: Sharpe > 1.5, Success > 70%]
    AA --> CC[–•–æ—Ä–æ—à–∞—è: Sharpe > 1.0, Success > 50%]
    AA --> DD[–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è: –∏–Ω–∞—á–µ]
    
    BB --> EE[‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é]
    CC --> FF[‚ö†Ô∏è –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞]
    DD --> GG[‚ùå –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏]
    
    EE --> HH[–î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω]
    FF --> II[–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    GG --> JJ[–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤]
    
    JJ --> KK[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π]
    JJ --> LL[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç–æ–¥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏]
    KK --> MM[–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    LL --> MM
    MM --> B
    
    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style O fill:#fff3e0
    style EE fill:#4caf50
    style FF fill:#ff9800
    style GG fill:#ffcdd2
```

### 1. –ü–∞–π–ø–ª–∞–π–Ω Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π

```python
class MonteCarloPipeline:
    """–ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π"""
    
    def __init__(self, data, model, metrics_calculator):
        self.data = data
        self.model = model
        self.metrics_calculator = metrics_calculator
        self.results = {}
    
    def run_parametric_simulations(self, n_simulations=10000, time_horizon=252, 
                                 distribution='normal'):
        """–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏"""
        returns = self.data['returns']
        
        if distribution == 'normal':
            simulations = normal_monte_carlo(returns, n_simulations, time_horizon)
        elif distribution == 't':
            simulations = t_distribution_monte_carlo(returns, n_simulations, time_horizon)
        elif distribution == 'mixture':
            simulations = mixture_monte_carlo(returns, n_simulations, time_horizon)
        else:
            raise ValueError(f"Unknown distribution: {distribution}")
        
        self.results[f'parametric_{distribution}'] = simulations
        return simulations
    
    def run_nonparametric_simulations(self, n_simulations=10000, time_horizon=252, 
                                    method='bootstrap'):
        """–ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏"""
        returns = self.data['returns']
        
        if method == 'bootstrap':
            simulations = bootstrap_monte_carlo(returns, n_simulations, time_horizon)
        elif method == 'permutation':
            simulations = permutation_monte_carlo(returns, n_simulations, time_horizon)
        else:
            raise ValueError(f"Unknown method: {method}")
        
        self.results[f'nonparametric_{method}'] = simulations
        return simulations
    
    def run_hybrid_simulations(self, n_simulations=10000, time_horizon=252, 
                             method='garch'):
        """–ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏"""
        returns = self.data['returns']
        
        if method == 'garch':
            simulations = garch_monte_carlo(returns, n_simulations, time_horizon)
        elif method == 'copula':
            simulations = copula_monte_carlo(returns, n_simulations, time_horizon)
        else:
            raise ValueError(f"Unknown method: {method}")
        
        self.results[f'hybrid_{method}'] = simulations
        return simulations
    
    def run_stress_test_simulations(self, n_simulations=10000, time_horizon=252, 
                                  stress_scenarios=None):
        """–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"""
        returns = self.data['returns']
        
        simulations = stress_test_monte_carlo(returns, n_simulations, time_horizon, 
                                            stress_scenarios)
        
        self.results['stress_test'] = simulations
        return simulations
    
    def generate_comprehensive_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        report = {
            'summary': {},
            'detailed_results': self.results,
            'recommendations': []
        }
        
        # –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞
        for method, simulations in self.results.items():
            if isinstance(simulations, pd.DataFrame):
                # –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
                mean_sharpe = simulations['sharpe'].mean()
                std_sharpe = simulations['sharpe'].std()
                mean_max_drawdown = simulations['max_drawdown'].mean()
                success_rate = (simulations['sharpe'] > 1.0).mean()
                
                # –†–∏—Å–∫-–º–µ—Ç—Ä–∏–∫–∏
                var_95 = simulations['sharpe'].quantile(0.05)
                es_95 = simulations[simulations['sharpe'] <= var_95]['sharpe'].mean()
                
                report['summary'][method] = {
                    'mean_sharpe': mean_sharpe,
                    'std_sharpe': std_sharpe,
                    'mean_max_drawdown': mean_max_drawdown,
                    'success_rate': success_rate,
                    'var_95': var_95,
                    'es_95': es_95
                }
                
                # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                if mean_sharpe > 1.5 and success_rate > 0.7:
                    report['recommendations'].append(f"{method}: –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")
                elif mean_sharpe > 1.0 and success_rate > 0.5:
                    report['recommendations'].append(f"{method}: –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å")
                else:
                    report['recommendations'].append(f"{method}: –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è")
        
        return report

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
pipeline = MonteCarloPipeline(data, model, metrics_calculator)
pipeline.run_parametric_simulations(distribution='normal')
pipeline.run_nonparametric_simulations(method='bootstrap')
pipeline.run_hybrid_simulations(method='garch')
pipeline.run_stress_test_simulations()
report = pipeline.generate_comprehensive_report()
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏ - —ç—Ç–æ –∫–ª—é—á –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ä–æ–±–∞—Å—Ç–Ω—ã—Ö –∏ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
2. **–£–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∏—Å–∫–∞–º–∏** - –ø–æ–Ω–∏–º–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
4. **–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–Ω–∞—á–∏–º–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏** - —É—á–∏—Ç—ã–≤–∞–π—Ç–µ VaR –∏ ES
4. **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ out-of-sample –¥–∞–Ω–Ω—ã—Ö

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –æ—Å–≤–æ–µ–Ω–∏—è Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫:

- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ](./30_portfolio_management.md)
