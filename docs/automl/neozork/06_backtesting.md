# 06. üìà –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥

**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∏ –∏–∑–±–µ–≥–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫.

## –ß—Ç–æ —Ç–∞–∫–æ–µ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥?

**–¢–µ–æ—Ä–∏—è:** –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ - —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —ç—Ç–∞–ø –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º, —Ç–∞–∫ –∫–∞–∫ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –æ—Ü–µ–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

**–ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥** - —ç—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –µ—ë –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏.

**–ü–æ—á–µ–º—É –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º:**
- **–°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –¥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** –î–∞–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ü–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ –ª—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥?

**–¢–µ–æ—Ä–∏—è:** –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Å–ª—É–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–º —Ü–µ–ª—è–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö —Ü–µ–ª–µ–π –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  - **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - **–ü–ª—é—Å—ã:** –û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
  - **–ú–∏–Ω—É—Å—ã:** –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –Ω–µ –æ—Ç—Ä–∞–∂–∞—Ç—å –±—É–¥—É—â–∏–µ —É—Å–ª–æ–≤–∏—è

- **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤** –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å
  - **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
  - **–ü–ª—é—Å—ã:** –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º
  - **–ú–∏–Ω—É—Å—ã:** –ü—Ä–æ—à–ª—ã–µ —Ä–∏—Å–∫–∏ –º–æ–≥—É—Ç –Ω–µ –æ—Ç—Ä–∞–∂–∞—Ç—å –±—É–¥—É—â–∏–µ

- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ –ª—É—á—à–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - **–ü–ª—é—Å—ã:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –¥–∞–Ω–Ω—ã–º
  - **–ú–∏–Ω—É—Å—ã:** –†–∏—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
  - **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  - **–ü–ª—é—Å—ã:** –û–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
  - **–ú–∏–Ω—É—Å—ã:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, —É—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞:**
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- **–û—Ü–µ–Ω–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫:** –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π, —Å–ø—Ä–µ–¥–æ–≤ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–ø–∏—Ç–∞–ª–∞

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞

**–¢–µ–æ—Ä–∏—è:** –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω –º–Ω–æ–∂–µ—Å—Ç–≤—É –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ª–æ–∂–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–∞–º. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö –æ—à–∏–±–æ–∫ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞.

### 1. Look-ahead bias (–ü—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç—å –±—É–¥—É—â–µ–≥–æ)

**–¢–µ–æ—Ä–∏—è:** Look-ahead bias - —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±—É–¥—É—â–µ–≥–æ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø—Ä–æ—à–ª–æ–º. –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏ –æ–ø–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–µ.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ:**
- **–ù–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å:** –í —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ –±—É–¥—É—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- **–ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–≤—ã—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–õ–æ–∂–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** –°–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏:** –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä—è–º –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ü–ª—é—Å—ã –∏–∑–±–µ–≥–∞–Ω–∏—è look-ahead bias:**
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤
- –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

**–ú–∏–Ω—É—Å—ã –∏–∑–±–µ–≥–∞–Ω–∏—è look-ahead bias:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –í–æ–∑–º–æ–∂–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—É–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
def bad_backtest(df):
    for i in range(len(df)):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É–¥—É—â–µ–≥–æ!
        if df.iloc[i]['Close'] > df.iloc[i+1]['Close']:  # –û–®–ò–ë–ö–ê!
            signal = 'BUY'
        else:
            signal = 'SELL'
    return signals

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ—à–ª—ã–µ –¥–∞–Ω–Ω—ã–µ
def good_backtest(df):
    signals = []
    for i in range(len(df)):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞
        if i > 0 and df.iloc[i]['Close'] > df.iloc[i-1]['Close']:
            signal = 'BUY'
        else:
            signal = 'SELL'
        signals.append(signal)
    return signals
```

### 2. Survivorship bias (–í—ã–∂–∏–≤–∞–Ω–∏—è)

**–¢–µ–æ—Ä–∏—è:** Survivorship bias - —ç—Ç–æ –æ—à–∏–±–∫–∞, –≤–æ–∑–Ω–∏–∫–∞—é—â–∞—è –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ "–≤—ã–∂–∏–≤—à–∏—Ö" –∞–∫—Ç–∏–≤–∞—Ö, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–≤—ã—à–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ:**
- **–ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤ –∏—Å–∫–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–ù–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å:** –í —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏
- **–õ–æ–∂–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** –°–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏:** –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä—è–º –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ü–ª—é—Å—ã —É—á–µ—Ç–∞ survivorship bias:**
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤
- –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

**–ú–∏–Ω—É—Å—ã —É—á–µ—Ç–∞ survivorship bias:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –í–æ–∑–º–æ–∂–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ "–≤—ã–∂–∏–≤—à–∏—Ö" –∞–∫—Ç–∏–≤–∞—Ö
def bad_survivorship_test():
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–µ–π—á–∞—Å
    symbols = ['AAPL', 'GOOGL', 'MSFT']  # –í—Å–µ —É—Å–ø–µ—à–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏
    return backtest_symbols(symbols)

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–∫–ª—é—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤—ã, –≤–∫–ª—é—á–∞—è "–º–µ—Ä—Ç–≤—ã–µ"
def good_survivorship_test():
    # –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—Ä–≥–æ–≤–∞–ª–∏—Å—å –≤ –ø–µ—Ä–∏–æ–¥
    symbols = ['AAPL', 'GOOGL', 'MSFT', 'ENRON', 'LEHMAN']  # –í–∫–ª—é—á–∞—è –±–∞–Ω–∫—Ä–æ—Ç–æ–≤
    return backtest_symbols(symbols)
```

### 3. Overfitting (–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ)

**–¢–µ–æ—Ä–∏—è:** Overfitting - —ç—Ç–æ –æ—à–∏–±–∫–∞, –≤–æ–∑–Ω–∏–∫–∞—é—â–∞—è –ø—Ä–∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ:**
- **–ù–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å:** –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–õ–æ–∂–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** –°–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏:** –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä—è–º –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ü–ª—é—Å—ã –∏–∑–±–µ–≥–∞–Ω–∏—è overfitting:**
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤
- –ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

**–ú–∏–Ω—É—Å—ã –∏–∑–±–µ–≥–∞–Ω–∏—è overfitting:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
def bad_optimization(df):
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
    best_params = optimize_parameters(df)  # –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ!
    return backtest_with_params(df, best_params)

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ä–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ train/test
def good_optimization(df):
    # –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    train_data = df[:int(len(df)*0.7)]
    test_data = df[int(len(df)*0.7):]
    
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –Ω–∞ train
    best_params = optimize_parameters(train_data)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ test
    return backtest_with_params(test_data, best_params)
```

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥

**–¢–µ–æ—Ä–∏—è:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Ç—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —É—á–µ—Ç–∞ –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤–∫–ª—é—á–∞—é—Ç:

1. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
2. **–£—á–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫** - –∫–æ–º–∏—Å—Å–∏–∏, —Å–ø—Ä–µ–¥—ã, –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏** - –æ—Ç–∫—Ä—ã—Ç–∏–µ, –∑–∞–∫—Ä—ã—Ç–∏–µ, –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç
4. **–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫** - –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫, –ø—Ä–æ—Å–∞–¥–∫–∏
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞

**–¢–µ–æ—Ä–∏—è:** –ö–ª–∞—Å—Å Backtester —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞. –û–Ω –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å—é –ª–æ–≥–∏–∫—É —Ç–æ—Ä–≥–æ–≤–ª–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º –∏ —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏
- **–û—Ç–ª–∞–¥–∫–∞:** –õ–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞ –∏ –ø–æ–∑–∏—Ü–∏–π
- **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫:** –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- **–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫:** –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–í–µ–¥–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:** –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```python
import pandas as pd
import numpy as np
from typing import Dict, List, Any, Optional
from dataclasses import dataclass
from datetime import datetime

@dataclass
class Trade:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–µ"""
    timestamp: datetime
    price: float
    quantity: float
    direction: str  # 'LONG' or 'SHORT'
    profit: float = 0.0
    commission: float = 0.0

class Backtester:
    """
    –ö–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    
    –≠—Ç–æ—Ç –∫–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞:
    1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∫–∞–ø–∏—Ç–∞–ª–æ–º
    2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    3. –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    4. –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    5. –í–µ–¥–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫
    """
    
    def __init__(self, initial_capital: float = 10000, commission: float = 0.001):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—ç–∫—Ç–µ—Å—Ç–µ—Ä–∞
        
        Args:
            initial_capital: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏
            commission: –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Å–¥–µ–ª–∫—É (–≤ –¥–æ–ª—è—Ö –æ—Ç —Å—É–º–º—ã)
        """
        self.initial_capital = initial_capital
        self.commission = commission
        self.capital = initial_capital  # –¢–µ–∫—É—â–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
        self.position = 0  # –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü –∞–∫—Ç–∏–≤–∞)
        self.position_value = 0  # –°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
        self.trades: List[Trade] = []  # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
        self.equity_curve: List[float] = []  # –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞
        self.daily_returns: List[float] = []  # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        
    def run_backtest(self, data: pd.DataFrame, strategy) -> Dict[str, Any]:
        """
        –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
        
        Args:
            data: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLCV)
            strategy: –û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –º–µ—Ç–æ–¥–æ–º get_signal()
            
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        """
        print(f"–ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –Ω–∞ {len(data)} –ø–µ—Ä–∏–æ–¥–∞—Ö...")
        
        # –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        self.capital = self.initial_capital
        self.position = 0
        self.position_value = 0
        self.trades = []
        self.equity_curve = []
        self.daily_returns = []
        
        for i, (timestamp, row) in enumerate(data.iterrows()):
            # –ü–æ–ª—É—á–∞–µ–º —Å–∏–≥–Ω–∞–ª –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
            signal = strategy.get_signal(data.iloc[:i+1])
            
            # –í—ã–ø–æ–ª–Ω—è–µ–º —Ç–æ—Ä–≥–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
            self.execute_trade(row, signal, timestamp)
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è
            current_equity = self.calculate_current_equity(row['Close'])
            self.equity_curve.append(current_equity)
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
            if i > 0:
                daily_return = (current_equity - self.equity_curve[i-1]) / self.equity_curve[i-1]
                self.daily_returns.append(daily_return)
        
        print(f"–ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω. –í—ã–ø–æ–ª–Ω–µ–Ω–æ {len(self.trades)} —Å–¥–µ–ª–æ–∫")
        return self.calculate_metrics()
    
    def execute_trade(self, row: pd.Series, signal: str, timestamp: datetime) -> None:
        """
        –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–≥–Ω–∞–ª–∞
        
        Args:
            row: –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (OHLCV)
            signal: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª ('BUY', 'SELL', 'HOLD')
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–¥–µ–ª–∫–∏
        """
        if signal == 'BUY' and self.position <= 0:
            # –ü–æ–∫—É–ø–∫–∞: –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é
            if self.position < 0:
                self.close_position(row['Close'], timestamp, 'SHORT')
            
            self.open_position(row['Close'], 'LONG', timestamp)
            
        elif signal == 'SELL' and self.position >= 0:
            # –ü—Ä–æ–¥–∞–∂–∞: –∑–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é
            if self.position > 0:
                self.close_position(row['Close'], timestamp, 'LONG')
            
            self.open_position(row['Close'], 'SHORT', timestamp)
            
        elif signal == 'HOLD':
            # –£–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
            pass
    
    def open_position(self, price: float, direction: str, timestamp: datetime) -> None:
        """
        –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
        
        Args:
            price: –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
            direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ('LONG' –∏–ª–∏ 'SHORT')
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        """
        if direction == 'LONG':
            # –ü–æ–∫—É–ø–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
            self.position = self.capital / price
            self.position_value = self.position * price
            self.capital = 0
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=self.position,
                direction='LONG',
                commission=self.position_value * self.commission
            )
            self.trades.append(trade)
            
        elif direction == 'SHORT':
            # –ü—Ä–æ–¥–∞–∂–∞: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
            self.position = -self.capital / price
            self.position_value = abs(self.position) * price
            self.capital = 0
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=abs(self.position),
                direction='SHORT',
                commission=self.position_value * self.commission
            )
            self.trades.append(trade)
    
    def close_position(self, price: float, timestamp: datetime, direction: str) -> None:
        """
        –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
        
        Args:
            price: –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
            direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º–æ–π –ø–æ–∑–∏—Ü–∏–∏
        """
        if direction == 'LONG' and self.position > 0:
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            self.capital = self.position * price * (1 - self.commission)
            profit = self.capital - self.position_value
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=self.position,
                direction='CLOSE_LONG',
                profit=profit,
                commission=self.position * price * self.commission
            )
            self.trades.append(trade)
            
        elif direction == 'SHORT' and self.position < 0:
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
            self.capital = -self.position * price * (1 - self.commission)
            profit = self.capital - self.position_value
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=abs(self.position),
                direction='CLOSE_SHORT',
                profit=profit,
                commission=abs(self.position) * price * self.commission
            )
            self.trades.append(trade)
        
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
        self.position = 0
        self.position_value = 0
    
    def calculate_current_equity(self, current_price: float) -> float:
        """
        –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
        
        Args:
            current_price: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∞–∫—Ç–∏–≤–∞
            
        Returns:
            –¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è
        """
        if self.position > 0:  # –î–ª–∏–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            return self.position * current_price
        elif self.position < 0:  # –ö–æ—Ä–æ—Ç–∫–∞—è –ø–æ–∑–∏—Ü–∏—è
            return self.capital + (-self.position * current_price)
        else:  # –ù–µ—Ç –ø–æ–∑–∏—Ü–∏–∏
            return self.capital
```

### 2. –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫

**–¢–µ–æ—Ä–∏—è:** –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —ç—Ç–∞–ø –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:

- **–û—Ü–µ–Ω–∏—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–∏
- **–ò–∑–º–µ—Ä–∏—Ç—å —Ä–∏—Å–∫** —á–µ—Ä–µ–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å–∞–¥–∫–∏
- **–°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –º–µ–∂–¥—É —Å–æ–±–æ–π –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ
- **–ü—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ** –æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å:** –û–±—â–∞—è, –≥–æ–¥–æ–≤–∞—è, —Å—Ä–µ–¥–Ω—è—è
- **–†–∏—Å–∫:** –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞, VaR
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** Sharpe ratio, Sortino ratio, Calmar ratio
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** Win rate, profit factor, recovery factor

```python
def calculate_metrics(self) -> Dict[str, Any]:
    """
    –†–∞—Å—á–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    
    –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
    –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
    
    1. –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ (return metrics)
    2. –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∏—Å–∫–∞ (risk metrics) 
    3. –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (efficiency metrics)
    4. –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (stability metrics)
    
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
    """
    if not self.equity_curve:
        return self._empty_metrics()
    
    # === –ú–ï–¢–†–ò–ö–ò –î–û–•–û–î–ù–û–°–¢–ò ===
    
    # –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (Total Return)
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
    total_return = (self.equity_curve[-1] - self.initial_capital) / self.initial_capital
    
    # –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (Annualized Return)
    # –ü—Ä–∏–≤–æ–¥–∏—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∫ –≥–æ–¥–æ–≤–æ–º—É —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    years = len(self.equity_curve) / 252  # 252 —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω—è –≤ –≥–æ–¥—É
    if years > 0:
        annual_return = (1 + total_return) ** (1/years) - 1
    else:
        annual_return = 0
    
    # –°—Ä–µ–¥–Ω—è—è –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    if self.daily_returns:
        avg_daily_return = np.mean(self.daily_returns)
    else:
        avg_daily_return = 0
    
    # === –ú–ï–¢–†–ò–ö–ò –†–ò–°–ö–ê ===
    
    # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (Volatility)
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π, –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–µ –∫ –≥–æ–¥–æ–≤–æ–º—É —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—É
    if self.daily_returns:
        volatility = np.std(self.daily_returns) * np.sqrt(252)
    else:
        volatility = 0
    
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ (Maximum Drawdown)
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –æ—Ç –ø–∏–∫–∞ –¥–æ –º–∏–Ω–∏–º—É–º–∞
    equity_series = pd.Series(self.equity_curve)
    running_max = equity_series.expanding().max()
    drawdown = (equity_series - running_max) / running_max
    max_drawdown = drawdown.min()
    
    # –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ—Å–∞–¥–∫–∞
    avg_drawdown = drawdown[drawdown < 0].mean() if (drawdown < 0).any() else 0
    
    # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏ (–≤ –¥–Ω—è—Ö)
    max_dd_duration = self._calculate_max_drawdown_duration(drawdown)
    
    # Value at Risk (VaR) - 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
    if self.daily_returns:
        var_95 = np.percentile(self.daily_returns, 5)
    else:
        var_95 = 0
    
    # === –ú–ï–¢–†–ò–ö–ò –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò ===
    
    # Sharpe Ratio
    # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    risk_free_rate = 0.02  # 2% –±–µ–∑—Ä–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
    if volatility > 0:
        sharpe_ratio = (annual_return - risk_free_rate) / volatility
    else:
        sharpe_ratio = 0
    
    # Sortino Ratio
    # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Sharpe, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    if self.daily_returns:
        negative_returns = [r for r in self.daily_returns if r < 0]
        if negative_returns:
            downside_volatility = np.std(negative_returns) * np.sqrt(252)
            if downside_volatility > 0:
                sortino_ratio = (annual_return - risk_free_rate) / downside_volatility
            else:
                sortino_ratio = 0
        else:
            sortino_ratio = float('inf') if annual_return > risk_free_rate else 0
    else:
        sortino_ratio = 0
    
    # Calmar Ratio
    # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ
    if abs(max_drawdown) > 0:
        calmar_ratio = annual_return / abs(max_drawdown)
    else:
        calmar_ratio = float('inf') if annual_return > 0 else 0
    
    # === –ú–ï–¢–†–ò–ö–ò –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò ===
    
    # Win Rate - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
    if self.trades:
        profitable_trades = [t for t in self.trades if t.profit > 0]
        win_rate = len(profitable_trades) / len(self.trades)
        
        # Profit Factor - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —É–±—ã—Ç–∫–∞–º
        total_profit = sum(t.profit for t in self.trades if t.profit > 0)
        total_loss = abs(sum(t.profit for t in self.trades if t.profit < 0))
        profit_factor = total_profit / total_loss if total_loss > 0 else float('inf')
        
        # –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å –∏ —É–±—ã—Ç–æ–∫
        avg_win = total_profit / len(profitable_trades) if profitable_trades else 0
        losing_trades = [t for t in self.trades if t.profit < 0]
        avg_loss = abs(sum(t.profit for t in losing_trades)) / len(losing_trades) if losing_trades else 0
        
        # Recovery Factor - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–µ
        recovery_factor = total_profit / abs(max_drawdown) if abs(max_drawdown) > 0 else float('inf')
    else:
        win_rate = 0
        profit_factor = 0
        avg_win = 0
        avg_loss = 0
        recovery_factor = 0
    
    # === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–†–ò–ö–ò ===
    
    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ (Coefficient of Variation)
    # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∫ —Å—Ä–µ–¥–Ω–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    if avg_daily_return != 0:
        coefficient_of_variation = volatility / (avg_daily_return * 252)
    else:
        coefficient_of_variation = float('inf')
    
    # –ò–Ω–¥–µ–∫—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (Stability Index)
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    if self.daily_returns:
        stability_index = 1 - (np.std(self.daily_returns) / abs(avg_daily_return)) if avg_daily_return != 0 else 0
    else:
        stability_index = 0
    
    return {
        # –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        'total_return': total_return,
        'annual_return': annual_return,
        'avg_daily_return': avg_daily_return,
        
        # –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∏—Å–∫–∞
        'volatility': volatility,
        'max_drawdown': max_drawdown,
        'avg_drawdown': avg_drawdown,
        'max_dd_duration': max_dd_duration,
        'var_95': var_95,
        
        # –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        'sharpe_ratio': sharpe_ratio,
        'sortino_ratio': sortino_ratio,
        'calmar_ratio': calmar_ratio,
        
        # –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
        'win_rate': win_rate,
        'profit_factor': profit_factor,
        'avg_win': avg_win,
        'avg_loss': avg_loss,
        'recovery_factor': recovery_factor,
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        'coefficient_of_variation': coefficient_of_variation,
        'stability_index': stability_index,
        'total_trades': len(self.trades),
        'final_capital': self.equity_curve[-1] if self.equity_curve else self.initial_capital
    }

def _calculate_max_drawdown_duration(self, drawdown: pd.Series) -> int:
    """
    –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏ –≤ –¥–Ω—è—Ö
    
    Args:
        drawdown: –°–µ—Ä–∏—è –ø—Ä–æ—Å–∞–¥–æ–∫
        
    Returns:
        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–∞–¥–∫–∏ –≤ –¥–Ω—è—Ö
    """
    if drawdown.empty:
        return 0
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–∏–æ–¥—ã –ø—Ä–æ—Å–∞–¥–∫–∏
    in_drawdown = drawdown < 0
    drawdown_periods = []
    current_period = 0
    
    for is_dd in in_drawdown:
        if is_dd:
            current_period += 1
        else:
            if current_period > 0:
                drawdown_periods.append(current_period)
            current_period = 0
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    if current_period > 0:
        drawdown_periods.append(current_period)
    
    return max(drawdown_periods) if drawdown_periods else 0

def _empty_metrics(self) -> Dict[str, Any]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
    return {
        'total_return': 0, 'annual_return': 0, 'avg_daily_return': 0,
        'volatility': 0, 'max_drawdown': 0, 'avg_drawdown': 0,
        'max_dd_duration': 0, 'var_95': 0, 'sharpe_ratio': 0,
        'sortino_ratio': 0, 'calmar_ratio': 0, 'win_rate': 0,
        'profit_factor': 0, 'avg_win': 0, 'avg_loss': 0,
        'recovery_factor': 0, 'coefficient_of_variation': 0,
        'stability_index': 0, 'total_trades': 0, 'final_capital': self.initial_capital
    }
```

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞

**–¢–µ–æ—Ä–∏—è:** –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π. –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –ø–æ–º–æ–≥–∞—é—Ç:

- **–ò–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è** —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö
- **–£—á–µ—Å—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Ä—ã–Ω–∫–∞

### 1. Walk-Forward Analysis

**–¢–µ–æ—Ä–∏—è:** Walk-Forward Analysis (WFA) - —ç—Ç–æ –º–µ—Ç–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –∫–æ—Ç–æ—Ä—ã–π –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:

1. **–û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—à–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - –æ–±—É—á–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ** - –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è —Å –¥–≤–∏–∂—É—â–∏–º—Å—è –æ–∫–Ω–æ–º –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ WFA:**
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å:** –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é
- **–ò–∑–±–µ–∂–∞–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è:** –°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –≤–∏–¥–∏—Ç –±—É–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- **–û—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:** –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Ä—ã–Ω–∫–∞

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **Train Period:** –î–ª–∏–Ω–∞ –æ–±—É—á–∞—é—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–æ–±—ã—á–Ω–æ 1-2 –≥–æ–¥–∞)
- **Test Period:** –î–ª–∏–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–æ–±—ã—á–Ω–æ 1-3 –º–µ—Å—è—Ü–∞)
- **Step Size:** –®–∞–≥ —Å–¥–≤–∏–≥–∞ –æ–∫–Ω–∞ (–æ–±—ã—á–Ω–æ —Ä–∞–≤–µ–Ω test_period)

```python
def walk_forward_analysis(data: pd.DataFrame, strategy, 
                         train_period: int = 252, 
                         test_period: int = 63,
                         step_size: int = None) -> List[Dict[str, Any]]:
    """
    –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    
    Walk-Forward –∞–Ω–∞–ª–∏–∑ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é:
    1. –û–±—É—á–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    2. –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    3. –°–¥–≤–∏–≥–∞–µ–º –æ–∫–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å
    
    Args:
        data: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLCV)
        strategy: –û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –º–µ—Ç–æ–¥–∞–º–∏ train() –∏ get_signal()
        train_period: –î–ª–∏–Ω–∞ –æ–±—É—á–∞—é—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 252)
        test_period: –î–ª–∏–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 63)
        step_size: –®–∞–≥ —Å–¥–≤–∏–≥–∞ –æ–∫–Ω–∞ –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–≤–µ–Ω test_period)
        
    Returns:
        –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
    """
    if step_size is None:
        step_size = test_period
    
    results = []
    total_periods = len(data) - train_period - test_period
    
    print(f"–ó–∞–ø—É—Å–∫ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞:")
    print(f"  - –û–±—É—á–∞—é—â–∏–π –ø–µ—Ä–∏–æ–¥: {train_period} –¥–Ω–µ–π")
    print(f"  - –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥: {test_period} –¥–Ω–µ–π")
    print(f"  - –®–∞–≥ —Å–¥–≤–∏–≥–∞: {step_size} –¥–Ω–µ–π")
    print(f"  - –í—Å–µ–≥–æ –ø–µ—Ä–∏–æ–¥–æ–≤: {total_periods // step_size + 1}")
    
    for start_idx in range(0, total_periods + 1, step_size):
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–∏–æ–¥–æ–≤
        train_start = start_idx
        train_end = start_idx + train_period
        test_start = train_end
        test_end = test_start + test_period
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
        if test_end > len(data):
            break
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        train_data = data.iloc[train_start:train_end].copy()
        test_data = data.iloc[test_start:test_end].copy()
        
        print(f"–ü–µ—Ä–∏–æ–¥ {len(results) + 1}: "
              f"–û–±—É—á–µ–Ω–∏–µ {train_data.index[0].date()} - {train_data.index[-1].date()}, "
              f"–¢–µ—Å—Ç {test_data.index[0].date()} - {test_data.index[-1].date()}")
        
        try:
            # –û–±—É—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            strategy.train(train_data)
            
            # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            backtester = Backtester()
            metrics = backtester.run_backtest(test_data, strategy)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            results.append({
                'period': len(results) + 1,
                'train_start': train_data.index[0],
                'train_end': train_data.index[-1],
                'test_start': test_data.index[0],
                'test_end': test_data.index[-1],
                'train_days': len(train_data),
                'test_days': len(test_data),
                'metrics': metrics,
                'trades': len(backtester.trades),
                'equity_curve': backtester.equity_curve.copy()
            })
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤ –ø–µ—Ä–∏–æ–¥–µ {len(results) + 1}: {e}")
            continue
    
    print(f"Walk-Forward –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(results)} –ø–µ—Ä–∏–æ–¥–æ–≤")
    return results

def analyze_walk_forward_results(results: List[Dict[str, Any]]) -> Dict[str, Any]:
    """
    –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞
    
    Args:
        results: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Walk-Forward –∞–Ω–∞–ª–∏–∑–∞
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
    """
    if not results:
        return {}
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ –≤—Å–µ—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
    all_returns = [r['metrics']['total_return'] for r in results]
    all_sharpe = [r['metrics']['sharpe_ratio'] for r in results]
    all_max_dd = [r['metrics']['max_drawdown'] for r in results]
    all_win_rates = [r['metrics']['win_rate'] for r in results]
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    analysis = {
        'total_periods': len(results),
        'avg_return': np.mean(all_returns),
        'std_return': np.std(all_returns),
        'min_return': np.min(all_returns),
        'max_return': np.max(all_returns),
        'positive_periods': sum(1 for r in all_returns if r > 0),
        'positive_periods_pct': sum(1 for r in all_returns if r > 0) / len(all_returns),
        
        'avg_sharpe': np.mean(all_sharpe),
        'std_sharpe': np.std(all_sharpe),
        'min_sharpe': np.min(all_sharpe),
        'max_sharpe': np.max(all_sharpe),
        
        'avg_max_dd': np.mean(all_max_dd),
        'worst_dd': np.min(all_max_dd),
        'avg_win_rate': np.mean(all_win_rates),
        
        'consistency_score': 1 - np.std(all_returns) / (np.mean(all_returns) + 1e-8),
        'stability_score': sum(1 for r in all_returns if r > 0) / len(all_returns)
    }
    
    return analysis
```

### 2. Monte Carlo Simulation

**–¢–µ–æ—Ä–∏—è:** Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è - —ç—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –≤—ã–±–æ—Ä–∫—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:

1. **–°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - —Å–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π —Ç–æ—Ä–≥–æ–≤—ã—Ö –¥–Ω–µ–π
2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±—ç–∫—Ç–µ—Å—Ç—ã** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–µ
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Monte Carlo:**
- **–û—Ü–µ–Ω–∫–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç–∏:** –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è—Ö
- **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏:** –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å —Ö—É–¥—à–∏–µ –∏ –ª—É—á—à–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:** –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ —Å–ª—É—á–∞–π–Ω—ã
- **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–ø–∏—Ç–∞–ª–∞
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:** –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

```python
def monte_carlo_simulation(data: pd.DataFrame, strategy, 
                          n_simulations: int = 1000,
                          block_size: int = 1) -> List[Dict[str, Any]]:
    """
    –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    
    Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫
    –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö.
    –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
    
    Args:
        data: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLCV)
        strategy: –û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –º–µ—Ç–æ–¥–æ–º get_signal()
        n_simulations: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
        block_size: –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        
    Returns:
        –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
    """
    print(f"–ó–∞–ø—É—Å–∫ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏:")
    print(f"  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º—É–ª—è—Ü–∏–π: {n_simulations}")
    print(f"  - –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤: {block_size}")
    print(f"  - –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {len(data)} –ø–µ—Ä–∏–æ–¥–æ–≤")
    
    results = []
    
    for i in range(n_simulations):
        if (i + 1) % 100 == 0:
            print(f"  –í—ã–ø–æ–ª–Ω–µ–Ω–æ {i + 1}/{n_simulations} —Å–∏–º—É–ª—è—Ü–∏–π")
        
        try:
            if block_size == 1:
                # –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                shuffled_data = data.sample(frac=1).reset_index(drop=True)
            else:
                # –ë–ª–æ—á–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö)
                shuffled_data = _block_shuffle_data(data, block_size)
            
            # –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –Ω–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            backtester = Backtester()
            metrics = backtester.run_backtest(shuffled_data, strategy)
            
            results.append({
                'simulation': i + 1,
                'metrics': metrics,
                'trades': len(backtester.trades),
                'final_capital': backtester.equity_curve[-1] if backtester.equity_curve else backtester.initial_capital
            })
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ {i + 1}: {e}")
            continue
    
    print(f"Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ {len(results)} —Å–∏–º—É–ª—è—Ü–∏–π")
    return results

def _block_shuffle_data(data: pd.DataFrame, block_size: int) -> pd.DataFrame:
    """
    –ë–ª–æ—á–Ω–∞—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    
    Args:
        data: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        block_size: –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤
        
    Returns:
        –ü–µ—Ä–µ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    """
    n_blocks = len(data) // block_size
    blocks = []
    
    for i in range(n_blocks):
        start_idx = i * block_size
        end_idx = start_idx + block_size
        block = data.iloc[start_idx:end_idx].copy()
        blocks.append(block)
    
    # –°–ª—É—á–∞–π–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏
    np.random.shuffle(blocks)
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–ª–æ–∫–∏
    shuffled_data = pd.concat(blocks, ignore_index=True)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
    remaining = len(data) % block_size
    if remaining > 0:
        remaining_data = data.iloc[-remaining:].copy()
        shuffled_data = pd.concat([shuffled_data, remaining_data], ignore_index=True)
    
    return shuffled_data

def analyze_monte_carlo_results(results: List[Dict[str, Any]]) -> Dict[str, Any]:
    """
    –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏
    
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    
    Args:
        results: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """
    if not results:
        return {}
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    returns = [r['metrics']['total_return'] for r in results]
    sharpe_ratios = [r['metrics']['sharpe_ratio'] for r in results]
    max_drawdowns = [r['metrics']['max_drawdown'] for r in results]
    win_rates = [r['metrics']['win_rate'] for r in results]
    final_capitals = [r['final_capital'] for r in results]
    
    # –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    analysis = {
        'n_simulations': len(results),
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        'return_stats': {
            'mean': np.mean(returns),
            'std': np.std(returns),
            'min': np.min(returns),
            'max': np.max(returns),
            'median': np.median(returns),
            'skewness': _calculate_skewness(returns),
            'kurtosis': _calculate_kurtosis(returns)
        },
        
        # –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        'return_percentiles': {
            'p1': np.percentile(returns, 1),
            'p5': np.percentile(returns, 5),
            'p10': np.percentile(returns, 10),
            'p25': np.percentile(returns, 25),
            'p50': np.percentile(returns, 50),
            'p75': np.percentile(returns, 75),
            'p90': np.percentile(returns, 90),
            'p95': np.percentile(returns, 95),
            'p99': np.percentile(returns, 99)
        },
        
        # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
        'probabilities': {
            'positive_return': np.mean([r > 0 for r in returns]),
            'negative_return': np.mean([r < 0 for r in returns]),
            'return_above_10pct': np.mean([r > 0.1 for r in returns]),
            'return_above_20pct': np.mean([r > 0.2 for r in returns]),
            'return_below_minus10pct': np.mean([r < -0.1 for r in returns]),
            'return_below_minus20pct': np.mean([r < -0.2 for r in returns])
        },
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∏—Å–∫–∞
        'risk_stats': {
            'avg_max_drawdown': np.mean(max_drawdowns),
            'worst_drawdown': np.min(max_drawdowns),
            'drawdown_std': np.std(max_drawdowns),
            'avg_sharpe': np.mean(sharpe_ratios),
            'sharpe_std': np.std(sharpe_ratios),
            'min_sharpe': np.min(sharpe_ratios),
            'max_sharpe': np.max(sharpe_ratios)
        },
        
        # VaR –∏ CVaR
        'var_cvar': {
            'var_95': np.percentile(returns, 5),
            'var_99': np.percentile(returns, 1),
            'cvar_95': np.mean([r for r in returns if r <= np.percentile(returns, 5)]),
            'cvar_99': np.mean([r for r in returns if r <= np.percentile(returns, 1)])
        },
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        'additional': {
            'avg_win_rate': np.mean(win_rates),
            'win_rate_std': np.std(win_rates),
            'avg_trades': np.mean([r['trades'] for r in results]),
            'consistency_score': 1 - np.std(returns) / (np.mean(returns) + 1e-8),
            'stability_score': np.mean([r > 0 for r in returns])
        }
    }
    
    return analysis

def _calculate_skewness(data: List[float]) -> float:
    """–†–∞—Å—á–µ—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"""
    if len(data) < 3:
        return 0
    mean = np.mean(data)
    std = np.std(data)
    if std == 0:
        return 0
    return np.mean([(x - mean) ** 3 for x in data]) / (std ** 3)

def _calculate_kurtosis(data: List[float]) -> float:
    """–†–∞—Å—á–µ—Ç —ç–∫—Å—Ü–µ—Å—Å–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"""
    if len(data) < 4:
        return 0
    mean = np.mean(data)
    std = np.std(data)
    if std == 0:
        return 0
    return np.mean([(x - mean) ** 4 for x in data]) / (std ** 4) - 3
```

### 3. Bootstrap Analysis

**–¢–µ–æ—Ä–∏—è:** Bootstrap –∞–Ω–∞–ª–∏–∑ - —ç—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –≤—ã–±–æ—Ä–∫—É —Å –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Monte Carlo, bootstrap —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
1. **–ë–ª–æ—á–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞** - —Å–æ–∑–¥–∞–µ–º –≤—ã–±–æ—Ä–∫–∏ –∏–∑ –±–ª–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞** - —Å–æ–∑–¥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** - –æ—Ü–µ–Ω–∏–≤–∞–µ–º –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Bootstrap:**
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:** –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω—ã—Ö
- **–ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–æ—Å—Ç—å:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏
- **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –î–∞–µ—Ç –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- **–û—Ü–µ–Ω–∫–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤** –¥–ª—è –º–µ—Ç—Ä–∏–∫
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∏–ø–æ—Ç–µ–∑** –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** —Å —É—á–µ—Ç–æ–º –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
def bootstrap_analysis(data: pd.DataFrame, strategy, 
                      n_bootstrap: int = 1000, 
                      block_size: int = 20) -> List[Dict[str, Any]]:
    """
    –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ Bootstrap –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    
    Bootstrap –∞–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫ –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å
    –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞.
    
    Args:
        data: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLCV)
        strategy: –û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –º–µ—Ç–æ–¥–æ–º get_signal()
        n_bootstrap: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ bootstrap –≤—ã–±–æ—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
        block_size: –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
        
    Returns:
        –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π bootstrap –≤—ã–±–æ—Ä–∫–∏
    """
    print(f"–ó–∞–ø—É—Å–∫ Bootstrap –∞–Ω–∞–ª–∏–∑–∞:")
    print(f"  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–∫: {n_bootstrap}")
    print(f"  - –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤: {block_size}")
    print(f"  - –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {len(data)} –ø–µ—Ä–∏–æ–¥–æ–≤")
    
    results = []
    n_blocks_needed = len(data) // block_size
    
    for i in range(n_bootstrap):
        if (i + 1) % 100 == 0:
            print(f"  –í—ã–ø–æ–ª–Ω–µ–Ω–æ {i + 1}/{n_bootstrap} –≤—ã–±–æ—Ä–æ–∫")
        
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ bootstrap –≤—ã–±–æ—Ä–∫–∏ —Å –±–ª–æ–∫–∞–º–∏
            bootstrap_data = _create_bootstrap_sample(data, block_size, n_blocks_needed)
            
            # –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –Ω–∞ bootstrap –≤—ã–±–æ—Ä–∫–µ
            backtester = Backtester()
            metrics = backtester.run_backtest(bootstrap_data, strategy)
            
            results.append({
                'bootstrap': i + 1,
                'metrics': metrics,
                'trades': len(backtester.trades),
                'final_capital': backtester.equity_curve[-1] if backtester.equity_curve else backtester.initial_capital
            })
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤ bootstrap –≤—ã–±–æ—Ä–∫–µ {i + 1}: {e}")
            continue
    
    print(f"Bootstrap –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ {len(results)} –≤—ã–±–æ—Ä–æ–∫")
    return results

def _create_bootstrap_sample(data: pd.DataFrame, block_size: int, n_blocks: int) -> pd.DataFrame:
    """
    –°–æ–∑–¥–∞–Ω–∏–µ bootstrap –≤—ã–±–æ—Ä–∫–∏ —Å –±–ª–æ–∫–∞–º–∏
    
    Args:
        data: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        block_size: –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤
        n_blocks: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏
        
    Returns:
        Bootstrap –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    """
    bootstrap_blocks = []
    max_start_idx = len(data) - block_size
    
    for _ in range(n_blocks):
        # –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –±–ª–æ–∫–∞
        start_idx = np.random.randint(0, max_start_idx + 1)
        end_idx = start_idx + block_size
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –±–ª–æ–∫
        block = data.iloc[start_idx:end_idx].copy()
        bootstrap_blocks.append(block)
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –±–ª–æ–∫–∏
    bootstrap_data = pd.concat(bootstrap_blocks, ignore_index=True)
    
    return bootstrap_data

def analyze_bootstrap_results(results: List[Dict[str, Any]], confidence_level: float = 0.95) -> Dict[str, Any]:
    """
    –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Bootstrap –∞–Ω–∞–ª–∏–∑–∞
    
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
    
    Args:
        results: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Bootstrap –∞–Ω–∞–ª–∏–∑–∞
        confidence_level: –£—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.95)
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """
    if not results:
        return {}
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    returns = [r['metrics']['total_return'] for r in results]
    sharpe_ratios = [r['metrics']['sharpe_ratio'] for r in results]
    max_drawdowns = [r['metrics']['max_drawdown'] for r in results]
    win_rates = [r['metrics']['win_rate'] for r in results]
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    alpha = 1 - confidence_level
    lower_percentile = (alpha / 2) * 100
    upper_percentile = (1 - alpha / 2) * 100
    
    analysis = {
        'n_bootstrap': len(results),
        'confidence_level': confidence_level,
        
        # –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        'return_ci': {
            'mean': np.mean(returns),
            'std': np.std(returns),
            'lower': np.percentile(returns, lower_percentile),
            'upper': np.percentile(returns, upper_percentile),
            'width': np.percentile(returns, upper_percentile) - np.percentile(returns, lower_percentile)
        },
        
        # –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è Sharpe ratio
        'sharpe_ci': {
            'mean': np.mean(sharpe_ratios),
            'std': np.std(sharpe_ratios),
            'lower': np.percentile(sharpe_ratios, lower_percentile),
            'upper': np.percentile(sharpe_ratios, upper_percentile),
            'width': np.percentile(sharpe_ratios, upper_percentile) - np.percentile(sharpe_ratios, lower_percentile)
        },
        
        # –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏
        'drawdown_ci': {
            'mean': np.mean(max_drawdowns),
            'std': np.std(max_drawdowns),
            'lower': np.percentile(max_drawdowns, lower_percentile),
            'upper': np.percentile(max_drawdowns, upper_percentile),
            'width': np.percentile(max_drawdowns, upper_percentile) - np.percentile(max_drawdowns, lower_percentile)
        },
        
        # –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è win rate
        'win_rate_ci': {
            'mean': np.mean(win_rates),
            'std': np.std(win_rates),
            'lower': np.percentile(win_rates, lower_percentile),
            'upper': np.percentile(win_rates, upper_percentile),
            'width': np.percentile(win_rates, upper_percentile) - np.percentile(win_rates, lower_percentile)
        },
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å
        'significance': {
            'return_significant': np.percentile(returns, lower_percentile) > 0,
            'sharpe_significant': np.percentile(sharpe_ratios, lower_percentile) > 0,
            'positive_return_prob': np.mean([r > 0 for r in returns]),
            'sharpe_above_1_prob': np.mean([s > 1 for s in sharpe_ratios])
        }
    }
    
    return analysis
```

## –£—á–µ—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏

**–¢–µ–æ—Ä–∏—è:** –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–≤—ã—à–µ–Ω–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–∞–º –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏:**
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏:** –ö–æ–º–∏—Å—Å–∏–∏, —Å–ø—Ä–µ–¥—ã, –Ω–∞–ª–æ–≥–∏
- **–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å:** –í–ª–∏—è–Ω–∏–µ –æ–±—ä–µ–º–∞ —Ç–æ—Ä–≥–æ–≤ –Ω–∞ —Ü–µ–Ω—É
- **–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:** –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –æ–∂–∏–¥–∞–µ–º–æ–π –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ü–µ–Ω–æ–π
- **–ó–∞–¥–µ—Ä–∂–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:** –í—Ä–µ–º—è –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π, –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ö–æ–º–∏—Å—Å–∏–∏ –∏ —Å–ø—Ä–µ–¥—ã

**–¢–µ–æ—Ä–∏—è:** –ö–æ–º–∏—Å—Å–∏–∏ –∏ —Å–ø—Ä–µ–¥—ã - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –£—á–µ—Ç —ç—Ç–∏—Ö –∏–∑–¥–µ—Ä–∂–µ–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫:**
- **–ö–æ–º–∏—Å—Å–∏–∏:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –±—Ä–æ–∫–µ—Ä—É
- **–°–ø—Ä–µ–¥—ã:** –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏
- **–ù–∞–ª–æ–≥–∏:** –ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥ —Å –ø—Ä–∏–±—ã–ª–∏
- **–°–±–æ—Ä—ã:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- **–°–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏:** –ü—Ä—è–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã —Ç–æ—Ä–≥–æ–≤:** –í—ã—Å–æ–∫–∏–µ –∏–∑–¥–µ—Ä–∂–∫–∏ –¥–µ–ª–∞—é—Ç —á–∞—Å—Ç—É—é —Ç–æ—Ä–≥–æ–≤–ª—é –Ω–µ–≤—ã–≥–æ–¥–Ω–æ–π
- **–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —É—á–∏—Ç—ã–≤–∞—Ç—å –∏–∑–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:** –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏

```python
class RealisticBacktester(Backtester):
    """
    –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–µ—Ä —Å —É—á–µ—Ç–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫
    
    –≠—Ç–æ—Ç –∫–ª–∞—Å—Å —Ä–∞—Å—à–∏—Ä—è–µ—Ç –±–∞–∑–æ–≤—ã–π Backtester –¥–ª—è —É—á–µ—Ç–∞
    —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏:
    - –ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ —Å–¥–µ–ª–∫–∏
    - –°–ø—Ä–µ–¥—ã –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏ –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏
    - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —á–∞—Å—Ç–æ—Ç—É —Ç–æ—Ä–≥–æ–≤
    """
    
    def __init__(self, initial_capital: float = 10000, 
                 commission: float = 0.001, 
                 spread: float = 0.0005,
                 min_position_size: float = 100,
                 min_trade_interval: int = 1):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–µ—Ä–∞
        
        Args:
            initial_capital: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
            commission: –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Å–¥–µ–ª–∫—É (–≤ –¥–æ–ª—è—Ö –æ—Ç —Å—É–º–º—ã)
            spread: –°–ø—Ä–µ–¥ –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏ –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ (–≤ –¥–æ–ª—è—Ö)
            min_position_size: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ –≤–∞–ª—é—Ç–µ
            min_trade_interval: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏ (–≤ –ø–µ—Ä–∏–æ–¥–∞—Ö)
        """
        super().__init__(initial_capital, commission)
        self.spread = spread
        self.min_position_size = min_position_size
        self.min_trade_interval = min_trade_interval
        self.last_trade_period = -min_trade_interval  # –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥ —Ç–æ—Ä–≥–æ–≤–ª–∏
        
    def execute_trade(self, row: pd.Series, signal: str, timestamp: datetime) -> None:
        """
        –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        
        –£—á–∏—Ç—ã–≤–∞–µ—Ç:
        - –°–ø—Ä–µ–¥—ã –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏ –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏
        - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–∑–∏—Ü–∏–π
        - –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏
        - –ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
        
        Args:
            row: –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (OHLCV)
            signal: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª ('BUY', 'SELL', 'HOLD')
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–¥–µ–ª–∫–∏
        """
        current_period = len(self.equity_curve)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏
        if current_period - self.last_trade_period < self.min_trade_interval:
            return
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–ø—Ä–µ–¥–∞
        if signal == 'BUY':
            # –ü–æ–∫—É–ø–∞–µ–º –ø–æ —Ü–µ–Ω–µ –≤—ã—à–µ —Ä—ã–Ω–æ—á–Ω–æ–π (ask price)
            price = row['Close'] * (1 + self.spread)
        elif signal == 'SELL':
            # –ü—Ä–æ–¥–∞–µ–º –ø–æ —Ü–µ–Ω–µ –Ω–∏–∂–µ —Ä—ã–Ω–æ—á–Ω–æ–π (bid price)
            price = row['Close'] * (1 - self.spread)
        else:
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        if signal == 'BUY' and self.capital < self.min_position_size:
            return
        elif signal == 'SELL' and self.position_value < self.min_position_size:
            return
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º —Å–¥–µ–ª–∫—É
        if signal == 'BUY' and self.position <= 0:
            if self.position < 0:
                # –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
                self.close_position(price, timestamp, 'SHORT')
            
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            self.open_position(price, 'LONG', timestamp)
            self.last_trade_period = current_period
            
        elif signal == 'SELL' and self.position >= 0:
            if self.position > 0:
                # –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                self.close_position(price, timestamp, 'LONG')
            
            # –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
            self.open_position(price, 'SHORT', timestamp)
            self.last_trade_period = current_period
    
    def open_position(self, price: float, direction: str, timestamp: datetime) -> None:
        """
        –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
        
        Args:
            price: –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (—Å —É—á–µ—Ç–æ–º —Å–ø—Ä–µ–¥–∞)
            direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ ('LONG' –∏–ª–∏ 'SHORT')
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        """
        if direction == 'LONG':
            # –ü–æ–∫—É–ø–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
            self.position = self.capital / price
            self.position_value = self.position * price
            self.capital = 0
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
            commission_cost = self.position_value * self.commission
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=self.position,
                direction='LONG',
                commission=commission_cost
            )
            self.trades.append(trade)
            
        elif direction == 'SHORT':
            # –ü—Ä–æ–¥–∞–∂–∞: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
            self.position = -self.capital / price
            self.position_value = abs(self.position) * price
            self.capital = 0
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
            commission_cost = self.position_value * self.commission
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=abs(self.position),
                direction='SHORT',
                commission=commission_cost
            )
            self.trades.append(trade)
    
    def close_position(self, price: float, timestamp: datetime, direction: str) -> None:
        """
        –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
        
        Args:
            price: –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (—Å —É—á–µ—Ç–æ–º —Å–ø—Ä–µ–¥–∞)
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
            direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º–æ–π –ø–æ–∑–∏—Ü–∏–∏
        """
        if direction == 'LONG' and self.position > 0:
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            self.capital = self.position * price * (1 - self.commission)
            profit = self.capital - self.position_value
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=self.position,
                direction='CLOSE_LONG',
                profit=profit,
                commission=self.position * price * self.commission
            )
            self.trades.append(trade)
            
        elif direction == 'SHORT' and self.position < 0:
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–æ–∑–∏—Ü–∏—é
            self.capital = -self.position * price * (1 - self.commission)
            profit = self.capital - self.position_value
            
            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–¥–µ–ª–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            trade = Trade(
                timestamp=timestamp,
                price=price,
                quantity=abs(self.position),
                direction='CLOSE_SHORT',
                profit=profit,
                commission=abs(self.position) * price * self.commission
            )
            self.trades.append(trade)
        
        # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
        self.position = 0
        self.position_value = 0
```

### 2. –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ

**–¢–µ–æ—Ä–∏—è:** –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ - —ç—Ç–æ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é, –Ω–æ —á–∞—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–æ—Å—Ç—ã—Ö –±—ç–∫—Ç–µ—Å—Ç–∞—Ö. –£—á–µ—Ç —ç—Ç–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–ß—Ç–æ —Ç–∞–∫–æ–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å:**
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ –∫—É–ø–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å –∞–∫—Ç–∏–≤ –±–µ–∑ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ü–µ–Ω—É
- **–§–∞–∫—Ç–æ—Ä—ã:** –û–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ:** –°–ø—Ä–µ–¥ bid-ask, –≥–ª—É–±–∏–Ω–∞ —Ä—ã–Ω–∫–∞, –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

**–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ:**
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –æ–∂–∏–¥–∞–µ–º–æ–π —Ü–µ–Ω–æ–π –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ü–µ–Ω–æ–π
- **–ü—Ä–∏—á–∏–Ω—ã:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
- **–¢–∏–ø—ã:** –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ (–≤—ã–≥–æ–¥–Ω–æ–µ) –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ (–Ω–µ–≤—ã–≥–æ–¥–Ω–æ–µ)

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é:**
- **–°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏:** –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ —É–º–µ–Ω—å—à–∞–µ—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:** –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —É—á–µ—Ç–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–π:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–º—ã

```python
def calculate_slippage(volume: float, market_volume: float, price: float, 
                      volatility: float = 0.02) -> float:
    """
    –†–∞—Å—á–µ—Ç –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—ä–µ–º–∞ –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
    
    –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
    - –û—Ç–Ω–æ—à–µ–Ω–∏—è –æ–±—ä–µ–º–∞ —Å–¥–µ–ª–∫–∏ –∫ —Ä—ã–Ω–æ—á–Ω–æ–º—É –æ–±—ä–µ–º—É
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∞
    - –í—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    - –ì–ª—É–±–∏–Ω—ã —Ä—ã–Ω–∫–∞
    
    Args:
        volume: –û–±—ä–µ–º –Ω–∞—à–µ–π —Å–¥–µ–ª–∫–∏
        market_volume: –°—Ä–µ–¥–Ω–∏–π —Ä—ã–Ω–æ—á–Ω—ã–π –æ–±—ä–µ–º
        price: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∞–∫—Ç–∏–≤–∞
        volatility: –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2%)
        
    Returns:
        –†–∞–∑–º–µ—Ä –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è –≤ –≤–∞–ª—é—Ç–µ
    """
    if market_volume <= 0:
        return 0
    
    # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –∫ —Ä—ã–Ω–æ—á–Ω–æ–º—É –æ–±—ä–µ–º—É
    volume_ratio = volume / market_volume
    
    # –ë–∞–∑–æ–≤–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞
    if volume_ratio < 0.001:  # –û—á–µ–Ω—å –º–∞–ª—ã–π –æ–±—ä–µ–º (< 0.1%)
        base_slippage = 0.0001
    elif volume_ratio < 0.01:  # –ú–∞–ª—ã–π –æ–±—ä–µ–º (0.1% - 1%)
        base_slippage = 0.0005
    elif volume_ratio < 0.05:  # –°—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º (1% - 5%)
        base_slippage = 0.001
    elif volume_ratio < 0.1:   # –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º (5% - 10%)
        base_slippage = 0.002
    else:  # –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º (> 10%)
        base_slippage = 0.005
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 1 + (volatility / 0.02)  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ 2%
    
    # –ò—Ç–æ–≥–æ–≤–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
    total_slippage = base_slippage * volatility_multiplier
    
    return price * total_slippage

def calculate_market_impact(volume: float, market_volume: float, 
                           price: float, volatility: float = 0.02) -> float:
    """
    –†–∞—Å—á–µ—Ç –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫ (market impact)
    
    Market impact - —ç—Ç–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞—à–µ–π —Å–¥–µ–ª–∫–∏ –Ω–∞ —Ü–µ–Ω—É –∞–∫—Ç–∏–≤–∞.
    –ß–µ–º –±–æ–ª—å—à–µ –æ–±—ä–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ, —Ç–µ–º –±–æ–ª—å—à–µ –≤–ª–∏—è–Ω–∏–µ.
    
    Args:
        volume: –û–±—ä–µ–º –Ω–∞—à–µ–π —Å–¥–µ–ª–∫–∏
        market_volume: –°—Ä–µ–¥–Ω–∏–π —Ä—ã–Ω–æ—á–Ω—ã–π –æ–±—ä–µ–º
        price: –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∞–∫—Ç–∏–≤–∞
        volatility: –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞
        
    Returns:
        –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ü–µ–Ω—É –≤ –≤–∞–ª—é—Ç–µ
    """
    if market_volume <= 0:
        return 0
    
    # –û—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –∫ —Ä—ã–Ω–æ—á–Ω–æ–º—É –æ–±—ä–µ–º—É
    volume_ratio = volume / market_volume
    
    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–ª–∏—è–Ω–∏—è (–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
    impact_coefficient = volume_ratio ** 1.5
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    volatility_multiplier = 1 + (volatility / 0.02)
    
    # –ò—Ç–æ–≥–æ–≤–æ–µ –≤–ª–∏—è–Ω–∏–µ
    total_impact = impact_coefficient * volatility_multiplier * 0.001
    
    return price * total_impact

class LiquidityAwareBacktester(RealisticBacktester):
    """
    –ë—ç–∫—Ç–µ—Å—Ç–µ—Ä —Å —É—á–µ—Ç–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
    
    –≠—Ç–æ—Ç –∫–ª–∞—Å—Å —Ä–∞—Å—à–∏—Ä—è–µ—Ç RealisticBacktester –¥–ª—è —É—á–µ—Ç–∞:
    - –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–¥–µ–ª–æ–∫
    - –í–ª–∏—è–Ω–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫ (market impact)
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
    - –í—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    """
    
    def __init__(self, initial_capital: float = 10000,
                 commission: float = 0.001,
                 spread: float = 0.0005,
                 min_position_size: float = 100,
                 min_trade_interval: int = 1,
                 max_volume_ratio: float = 0.1,
                 execution_delay: int = 0):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—ç–∫—Ç–µ—Å—Ç–µ—Ä–∞ —Å —É—á–µ—Ç–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        
        Args:
            initial_capital: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
            commission: –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Å–¥–µ–ª–∫—É
            spread: –°–ø—Ä–µ–¥ –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏
            min_position_size: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
            min_trade_interval: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏
            max_volume_ratio: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –∫ —Ä—ã–Ω–æ—á–Ω–æ–º—É
            execution_delay: –ó–∞–¥–µ—Ä–∂–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ø–µ—Ä–∏–æ–¥–∞—Ö
        """
        super().__init__(initial_capital, commission, spread, 
                        min_position_size, min_trade_interval)
        self.max_volume_ratio = max_volume_ratio
        self.execution_delay = execution_delay
        self.pending_orders = []  # –û–∂–∏–¥–∞—é—â–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
        
    def execute_trade(self, row: pd.Series, signal: str, timestamp: datetime) -> None:
        """
        –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤ —Å —É—á–µ—Ç–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        
        Args:
            row: –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (OHLCV)
            signal: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        """
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–∂–∏–¥–∞—é—â–∏–µ –æ—Ä–¥–µ—Ä–∞
        self._process_pending_orders(row, timestamp)
        
        if signal in ['BUY', 'SELL']:
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä–µ–º —Å–¥–µ–ª–∫–∏
            if signal == 'BUY':
                volume = self.capital / row['Close']
            else:  # SELL
                volume = abs(self.position) if self.position != 0 else 0
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
            if not self._check_liquidity_constraints(volume, row['Volume']):
                return
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ –∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä—ã–Ω–æ–∫
            slippage = calculate_slippage(volume, row['Volume'], row['Close'])
            market_impact = calculate_market_impact(volume, row['Volume'], row['Close'])
            
            # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ü–µ–Ω—É
            if signal == 'BUY':
                price = row['Close'] + slippage + market_impact
            else:  # SELL
                price = row['Close'] - slippage - market_impact
            
            # –°–æ–∑–¥–∞–µ–º –æ—Ä–¥–µ—Ä —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
            if self.execution_delay > 0:
                self.pending_orders.append({
                    'signal': signal,
                    'price': price,
                    'volume': volume,
                    'timestamp': timestamp,
                    'execution_time': len(self.equity_curve) + self.execution_delay
                })
            else:
                # –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
                self._execute_immediate_trade(signal, price, timestamp)
    
    def _check_liquidity_constraints(self, volume: float, market_volume: float) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        
        Args:
            volume: –û–±—ä–µ–º –Ω–∞—à–µ–π —Å–¥–µ–ª–∫–∏
            market_volume: –†—ã–Ω–æ—á–Ω—ã–π –æ–±—ä–µ–º
            
        Returns:
            True, –µ—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–±–ª—é–¥–µ–Ω—ã
        """
        if market_volume <= 0:
            return False
        
        volume_ratio = volume / market_volume
        return volume_ratio <= self.max_volume_ratio
    
    def _process_pending_orders(self, row: pd.Series, timestamp: datetime) -> None:
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∂–∏–¥–∞—é—â–∏—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
        
        Args:
            row: –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            timestamp: –¢–µ–∫—É—â–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        """
        current_period = len(self.equity_curve)
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –æ—Ä–¥–µ—Ä–∞, –≥–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é
        ready_orders = [order for order in self.pending_orders 
                       if order['execution_time'] <= current_period]
        
        for order in ready_orders:
            self._execute_immediate_trade(
                order['signal'], 
                order['price'], 
                order['timestamp']
            )
        
        # –£–¥–∞–ª—è–µ–º –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞
        self.pending_orders = [order for order in self.pending_orders 
                              if order['execution_time'] > current_period]
    
    def _execute_immediate_trade(self, signal: str, price: float, timestamp: datetime) -> None:
        """
        –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
        
        Args:
            signal: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
            price: –¶–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
            timestamp: –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        """
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–∞–Ω–Ω—ã—Ö —Å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ü–µ–Ω–æ–π
        temp_row = pd.Series({'Close': price})
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º —Å–¥–µ–ª–∫—É —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –º–µ—Ç–æ–¥
        super().execute_trade(temp_row, signal, timestamp)
```

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–¢–µ–æ—Ä–∏—è:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç:

- **–í—ã—è–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã** –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–û–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã** –≤ –ª–æ–≥–∏–∫–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
- **–°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –≤–∏–∑—É–∞–ª—å–Ω–æ
- **–ü–æ–Ω—è—Ç—å —Ä–∏—Å–∫–∏** —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ—Å–∞–¥–æ–∫
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

**–¢–∏–ø—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
- **–ö—Ä–∏–≤—ã–µ –∫–∞–ø–∏—Ç–∞–ª–∞:** –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ—Å–∞–¥–æ–∫:** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç –ø–æ—Ç–µ—Ä–∏ –æ—Ç –ø–∏–∫–æ–≤
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏:** –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞
- **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–∞–º–∏
- **–¢–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:** –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

### 1. Equity Curve

**–¢–µ–æ—Ä–∏—è:** –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞ (equity curve) - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –û–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- **–û—Ü–µ–Ω–∏—Ç—å –æ–±—â—É—é —Ç–µ–Ω–¥–µ–Ω—Ü–∏—é** - —Ä–∞—Å—Ç–µ—Ç –∏–ª–∏ –ø–∞–¥–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª
- **–í—ã—è–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã —Å—Ç–∞–≥–Ω–∞—Ü–∏–∏** - –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–û–±–Ω–∞—Ä—É–∂–∏—Ç—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** - –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- **–°—Ä–∞–≤–Ω–∏—Ç—å —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º** - –ª—É—á—à–µ –∏–ª–∏ —Ö—É–∂–µ —Ä—ã–Ω–∫–∞

```python
import matplotlib.pyplot as plt
import matplotlib.dates as mdates
from datetime import datetime
import seaborn as sns

def plot_equity_curve(equity_curve: List[float], 
                     dates: List[datetime] = None,
                     benchmark: List[float] = None,
                     benchmark_dates: List[datetime] = None,
                     title: str = "Equity Curve",
                     figsize: tuple = (15, 8)) -> None:
    """
    –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫—Ä–∏–≤–æ–π –∫–∞–ø–∏—Ç–∞–ª–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    
    Args:
        equity_curve: –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–ø–∏—Ç–∞–ª–∞
        dates: –°–ø–∏—Å–æ–∫ –¥–∞—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
        benchmark: –ö—Ä–∏–≤–∞—è –±–µ–Ω—á–º–∞—Ä–∫–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        benchmark_dates: –î–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–∞
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
        figsize: –†–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
    """
    plt.figure(figsize=figsize)
    
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    if dates is not None:
        x_data = dates
        x_label = "Date"
    else:
        x_data = range(len(equity_curve))
        x_label = "Period"
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∫—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞
    plt.plot(x_data, equity_curve, label='Strategy', linewidth=2, color='blue')
    
    # –ë–µ–Ω—á–º–∞—Ä–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if benchmark is not None:
        if benchmark_dates is not None:
            plt.plot(benchmark_dates, benchmark, label='Benchmark', 
                    linewidth=2, alpha=0.7, color='orange')
        else:
            plt.plot(x_data[:len(benchmark)], benchmark, label='Benchmark', 
                    linewidth=2, alpha=0.7, color='orange')
    
    # –ù–∞—á–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞
    initial_capital = equity_curve[0]
    plt.axhline(y=initial_capital, color='gray', linestyle='--', alpha=0.5, 
                label=f'Initial Capital: ${initial_capital:,.0f}')
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    plt.title(title, fontsize=16, fontweight='bold')
    plt.xlabel(x_label, fontsize=12)
    plt.ylabel('Portfolio Value ($)', fontsize=12)
    plt.legend(fontsize=11)
    plt.grid(True, alpha=0.3)
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–µ–π
    if dates is not None:
        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter('%Y-%m'))
        plt.gca().xaxis.set_major_locator(mdates.MonthLocator(interval=3))
        plt.xticks(rotation=45)
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–∏ Y
    plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'${x:,.0f}'))
    
    plt.tight_layout()
    plt.show()

def plot_equity_curve_with_metrics(equity_curve: List[float], 
                                  metrics: Dict[str, Any],
                                  dates: List[datetime] = None,
                                  title: str = "Equity Curve with Metrics") -> None:
    """
    –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫—Ä–∏–≤–æ–π –∫–∞–ø–∏—Ç–∞–ª–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
    
    Args:
        equity_curve: –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–ø–∏—Ç–∞–ª–∞
        metrics: –°–ª–æ–≤–∞—Ä—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
        dates: –°–ø–∏—Å–æ–∫ –¥–∞—Ç
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
    """
    fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(15, 10), 
                                   gridspec_kw={'height_ratios': [3, 1]})
    
    # –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ - –∫—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞
    if dates is not None:
        ax1.plot(dates, equity_curve, linewidth=2, color='blue')
    else:
        ax1.plot(equity_curve, linewidth=2, color='blue')
    
    ax1.set_title(title, fontsize=16, fontweight='bold')
    ax1.set_ylabel('Portfolio Value ($)', fontsize=12)
    ax1.grid(True, alpha=0.3)
    ax1.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'${x:,.0f}'))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫
    metrics_text = f"""
    Total Return: {metrics.get('total_return', 0):.2%}
    Annual Return: {metrics.get('annual_return', 0):.2%}
    Sharpe Ratio: {metrics.get('sharpe_ratio', 0):.2f}
    Max Drawdown: {metrics.get('max_drawdown', 0):.2%}
    Win Rate: {metrics.get('win_rate', 0):.2%}
    """
    ax1.text(0.02, 0.98, metrics_text, transform=ax1.transAxes, 
             verticalalignment='top', bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.8))
    
    # –ù–∏–∂–Ω–∏–π –≥—Ä–∞—Ñ–∏–∫ - –ø—Ä–æ—Å–∞–¥–∫–∏
    equity_series = pd.Series(equity_curve)
    running_max = equity_series.expanding().max()
    drawdown = (equity_series - running_max) / running_max
    
    if dates is not None:
        ax2.fill_between(dates, drawdown, 0, alpha=0.3, color='red')
        ax2.plot(dates, drawdown, color='red', linewidth=1)
    else:
        ax2.fill_between(range(len(drawdown)), drawdown, 0, alpha=0.3, color='red')
        ax2.plot(drawdown, color='red', linewidth=1)
    
    ax2.set_title('Drawdown', fontsize=14)
    ax2.set_xlabel('Time', fontsize=12)
    ax2.set_ylabel('Drawdown %', fontsize=12)
    ax2.grid(True, alpha=0.3)
    ax2.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    plt.tight_layout()
    plt.show()
```

### 2. Drawdown Chart

**–¢–µ–æ—Ä–∏—è:** –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Å–∞–¥–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –æ—Ç –ø–∏–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∏—Å–∫–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞** - —Ö—É–¥—à–∞—è –ø–æ—Ç–µ—Ä—è –æ—Ç –ø–∏–∫–∞
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–∞–¥–æ–∫** - –∫–∞–∫ –¥–æ–ª–≥–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- **–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ—Å–∞–¥–æ–∫** - –∫–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø–æ—Ç–µ—Ä–∏
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–∏–∫–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

```python
def plot_drawdown_analysis(equity_curve: List[float], 
                          dates: List[datetime] = None,
                          title: str = "Drawdown Analysis") -> None:
    """
    –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Å–∞–¥–æ–∫
    
    Args:
        equity_curve: –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–ø–∏—Ç–∞–ª–∞
        dates: –°–ø–∏—Å–æ–∫ –¥–∞—Ç
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
    """
    fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(15, 12))
    
    equity_series = pd.Series(equity_curve)
    running_max = equity_series.expanding().max()
    drawdown = (equity_series - running_max) / running_max
    
    # –ì—Ä–∞—Ñ–∏–∫ 1: –ö—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞ —Å –ø–∏–∫–∞–º–∏
    if dates is not None:
        ax1.plot(dates, equity_curve, label='Portfolio Value', linewidth=2, color='blue')
        ax1.plot(dates, running_max, label='Running Maximum', linewidth=1, 
                color='green', linestyle='--', alpha=0.7)
    else:
        ax1.plot(equity_curve, label='Portfolio Value', linewidth=2, color='blue')
        ax1.plot(running_max, label='Running Maximum', linewidth=1, 
                color='green', linestyle='--', alpha=0.7)
    
    ax1.set_title(f'{title} - Portfolio Value', fontsize=14)
    ax1.set_ylabel('Value ($)', fontsize=12)
    ax1.legend()
    ax1.grid(True, alpha=0.3)
    ax1.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'${x:,.0f}'))
    
    # –ì—Ä–∞—Ñ–∏–∫ 2: –ü—Ä–æ—Å–∞–¥–∫–∏
    if dates is not None:
        ax2.fill_between(dates, drawdown, 0, alpha=0.3, color='red')
        ax2.plot(dates, drawdown, color='red', linewidth=1)
    else:
        ax2.fill_between(range(len(drawdown)), drawdown, 0, alpha=0.3, color='red')
        ax2.plot(drawdown, color='red', linewidth=1)
    
    ax2.set_title('Drawdown', fontsize=14)
    ax2.set_ylabel('Drawdown %', fontsize=12)
    ax2.grid(True, alpha=0.3)
    ax2.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    # –ì—Ä–∞—Ñ–∏–∫ 3: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Å–∞–¥–æ–∫
    drawdown_clean = drawdown[drawdown < 0]  # –¢–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Å–∞–¥–∫–∏
    if len(drawdown_clean) > 0:
        ax3.hist(drawdown_clean, bins=30, alpha=0.7, color='red', density=True)
        ax3.axvline(drawdown_clean.mean(), color='black', linestyle='--', 
                   label=f'Mean: {drawdown_clean.mean():.2%}')
        ax3.axvline(drawdown_clean.min(), color='darkred', linestyle='--', 
                   label=f'Min: {drawdown_clean.min():.2%}')
    
    ax3.set_title('Drawdown Distribution', fontsize=14)
    ax3.set_xlabel('Drawdown %', fontsize=12)
    ax3.set_ylabel('Density', fontsize=12)
    ax3.legend()
    ax3.grid(True, alpha=0.3)
    ax3.xaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    plt.tight_layout()
    plt.show()

def plot_rolling_metrics(equity_curve: List[float], 
                        window: int = 252,
                        dates: List[datetime] = None) -> None:
    """
    –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö –º–µ—Ç—Ä–∏–∫
    
    Args:
        equity_curve: –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–ø–∏—Ç–∞–ª–∞
        window: –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫
        dates: –°–ø–∏—Å–æ–∫ –¥–∞—Ç
    """
    equity_series = pd.Series(equity_curve)
    returns = equity_series.pct_change().dropna()
    
    # –°–∫–æ–ª—å–∑—è—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    rolling_returns = returns.rolling(window).mean() * 252  # –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    rolling_vol = returns.rolling(window).std() * np.sqrt(252)  # –ì–æ–¥–æ–≤–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    rolling_sharpe = rolling_returns / rolling_vol  # –°–∫–æ–ª—å–∑—è—â–∏–π Sharpe ratio
    
    fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(15, 10))
    
    # –ì—Ä–∞—Ñ–∏–∫ 1: –°–∫–æ–ª—å–∑—è—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    if dates is not None:
        ax1.plot(dates[1:], rolling_returns, label='Rolling Annual Return', linewidth=2)
    else:
        ax1.plot(rolling_returns, label='Rolling Annual Return', linewidth=2)
    
    ax1.set_title('Rolling Annual Return', fontsize=14)
    ax1.set_ylabel('Return', fontsize=12)
    ax1.legend()
    ax1.grid(True, alpha=0.3)
    ax1.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    # –ì—Ä–∞—Ñ–∏–∫ 2: –°–∫–æ–ª—å–∑—è—â–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    if dates is not None:
        ax2.plot(dates[1:], rolling_vol, label='Rolling Volatility', linewidth=2, color='orange')
    else:
        ax2.plot(rolling_vol, label='Rolling Volatility', linewidth=2, color='orange')
    
    ax2.set_title('Rolling Volatility', fontsize=14)
    ax2.set_ylabel('Volatility', fontsize=12)
    ax2.legend()
    ax2.grid(True, alpha=0.3)
    ax2.yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    # –ì—Ä–∞—Ñ–∏–∫ 3: –°–∫–æ–ª—å–∑—è—â–∏–π Sharpe ratio
    if dates is not None:
        ax3.plot(dates[1:], rolling_sharpe, label='Rolling Sharpe Ratio', linewidth=2, color='green')
    else:
        ax3.plot(rolling_sharpe, label='Rolling Sharpe Ratio', linewidth=2, color='green')
    
    ax3.set_title('Rolling Sharpe Ratio', fontsize=14)
    ax3.set_xlabel('Time', fontsize=12)
    ax3.set_ylabel('Sharpe Ratio', fontsize=12)
    ax3.legend()
    ax3.grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.show()
```

### 3. Returns Distribution

**–¢–µ–æ—Ä–∏—è:** –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

- **–ù–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é
- **–ê—Å–∏–º–º–µ—Ç—Ä–∏—è** - —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
- **–≠–∫—Å—Ü–µ—Å—Å** - —á–∞—Å—Ç–æ—Ç–∞ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- **–•–≤–æ—Å—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–µ—Ä—å –∏–ª–∏ –ø—Ä–∏–±—ã–ª–µ–π

```python
from scipy import stats
import seaborn as sns

def plot_returns_analysis(returns: List[float], 
                         title: str = "Returns Analysis") -> None:
    """
    –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
    
    Args:
        returns: –°–ø–∏—Å–æ–∫ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
    """
    returns_series = pd.Series(returns)
    
    fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(15, 10))
    
    # –ì—Ä–∞—Ñ–∏–∫ 1: –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
    ax1.hist(returns_series, bins=50, alpha=0.7, density=True, 
             label='Returns', color='skyblue', edgecolor='black')
    
    # –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    mu, sigma = returns_series.mean(), returns_series.std()
    x = np.linspace(returns_series.min(), returns_series.max(), 100)
    normal_dist = stats.norm.pdf(x, mu, sigma)
    ax1.plot(x, normal_dist, 'r-', linewidth=2, label='Normal Distribution')
    
    ax1.set_title('Returns Distribution', fontsize=14)
    ax1.set_xlabel('Returns', fontsize=12)
    ax1.set_ylabel('Density', fontsize=12)
    ax1.legend()
    ax1.grid(True, alpha=0.3)
    
    # –ì—Ä–∞—Ñ–∏–∫ 2: Q-Q plot –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏
    stats.probplot(returns_series, dist="norm", plot=ax2)
    ax2.set_title('Q-Q Plot (Normal Distribution)', fontsize=14)
    ax2.grid(True, alpha=0.3)
    
    # –ì—Ä–∞—Ñ–∏–∫ 3: Box plot
    ax3.boxplot(returns_series, vert=True)
    ax3.set_title('Box Plot', fontsize=14)
    ax3.set_ylabel('Returns', fontsize=12)
    ax3.grid(True, alpha=0.3)
    
    # –ì—Ä–∞—Ñ–∏–∫ 4: –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    sorted_returns = np.sort(returns_series)
    cumulative = np.arange(1, len(sorted_returns) + 1) / len(sorted_returns)
    ax4.plot(sorted_returns, cumulative, linewidth=2, label='Empirical CDF')
    
    # –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è CDF –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    normal_cdf = stats.norm.cdf(sorted_returns, mu, sigma)
    ax4.plot(sorted_returns, normal_cdf, 'r--', linewidth=2, label='Normal CDF')
    
    ax4.set_title('Cumulative Distribution Function', fontsize=14)
    ax4.set_xlabel('Returns', fontsize=12)
    ax4.set_ylabel('Cumulative Probability', fontsize=12)
    ax4.legend()
    ax4.grid(True, alpha=0.3)
    
    plt.suptitle(title, fontsize=16, fontweight='bold')
    plt.tight_layout()
    plt.show()
    
    # –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    print(f"\n=== Returns Statistics ===")
    print(f"Count: {len(returns_series)}")
    print(f"Mean: {returns_series.mean():.4f}")
    print(f"Std: {returns_series.std():.4f}")
    print(f"Skewness: {returns_series.skew():.4f}")
    print(f"Kurtosis: {returns_series.kurtosis():.4f}")
    print(f"Min: {returns_series.min():.4f}")
    print(f"Max: {returns_series.max():.4f}")
    
    # –¢–µ—Å—Ç –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å
    shapiro_stat, shapiro_p = stats.shapiro(returns_series)
    print(f"\nShapiro-Wilk Test:")
    print(f"Statistic: {shapiro_stat:.4f}")
    print(f"P-value: {shapiro_p:.4f}")
    print(f"Normal distribution: {'Yes' if shapiro_p > 0.05 else 'No'}")

def plot_risk_return_scatter(returns: List[float], 
                           window: int = 252,
                           title: str = "Risk-Return Analysis") -> None:
    """
    –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    
    Args:
        returns: –°–ø–∏—Å–æ–∫ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
        window: –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
        title: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
    """
    returns_series = pd.Series(returns)
    
    # –°–∫–æ–ª—å–∑—è—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    rolling_returns = returns_series.rolling(window).mean() * 252
    rolling_vol = returns_series.rolling(window).std() * np.sqrt(252)
    
    # –£–±–∏—Ä–∞–µ–º NaN –∑–Ω–∞—á–µ–Ω–∏—è
    valid_data = pd.DataFrame({
        'returns': rolling_returns,
        'volatility': rolling_vol
    }).dropna()
    
    plt.figure(figsize=(12, 8))
    
    # Scatter plot
    scatter = plt.scatter(valid_data['volatility'], valid_data['returns'], 
                         c=range(len(valid_data)), cmap='viridis', alpha=0.6)
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é —à–∫–∞–ª—É
    cbar = plt.colorbar(scatter)
    cbar.set_label('Time', fontsize=12)
    
    # –õ–∏–Ω–∏–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ Sharpe ratio
    sharpe_ratios = [0.5, 1.0, 1.5, 2.0]
    x_vol = np.linspace(valid_data['volatility'].min(), valid_data['volatility'].max(), 100)
    
    for sr in sharpe_ratios:
        y_return = sr * x_vol
        plt.plot(x_vol, y_return, '--', alpha=0.7, 
                label=f'Sharpe = {sr}')
    
    plt.xlabel('Volatility (Annualized)', fontsize=12)
    plt.ylabel('Return (Annualized)', fontsize=12)
    plt.title(title, fontsize=14, fontweight='bold')
    plt.legend()
    plt.grid(True, alpha=0.3)
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–µ–π
    plt.gca().xaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
    
    plt.tight_layout()
    plt.show()
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

**–¢–µ–æ—Ä–∏—è:** –ü–æ–ª–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤—Å–µ —ç—Ç–∞–ø—ã: –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –∏–∑—É—á–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

**–≠—Ç–∞–ø—ã –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞:**
1. **–ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥** - –æ—Å–Ω–æ–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. **Walk-Forward –∞–Ω–∞–ª–∏–∑** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
3. **Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è** - –æ—Ü–µ–Ω–∫–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏
4. **Bootstrap –∞–Ω–∞–ª–∏–∑** - —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
5. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
6. **–û—Ç—á–µ—Ç** - —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –∏ –≤—ã–≤–æ–¥–æ–≤

```python
class CompleteBacktest:
    """
    –ö–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    
    –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞:
    - –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
    - Walk-Forward –∞–Ω–∞–ª–∏–∑
    - Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è
    - Bootstrap –∞–Ω–∞–ª–∏–∑
    - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    """
    
    def __init__(self, data: pd.DataFrame, strategy, 
                 initial_capital: float = 10000,
                 commission: float = 0.001,
                 spread: float = 0.0005):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
        
        Args:
            data: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLCV)
            strategy: –û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            initial_capital: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
            commission: –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Å–¥–µ–ª–∫—É
            spread: –°–ø—Ä–µ–¥ –º–µ–∂–¥—É —Ü–µ–Ω–∞–º–∏
        """
        self.data = data
        self.strategy = strategy
        self.initial_capital = initial_capital
        self.commission = commission
        self.spread = spread
        
        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
        self.basic_results = None
        self.wf_results = None
        self.mc_results = None
        self.bootstrap_results = None
        
    def run_complete_analysis(self, 
                            wf_train_period: int = 252,
                            wf_test_period: int = 63,
                            mc_simulations: int = 1000,
                            bootstrap_samples: int = 1000,
                            bootstrap_block_size: int = 20) -> Dict[str, Any]:
        """
        –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        
        Args:
            wf_train_period: –ü–µ—Ä–∏–æ–¥ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è Walk-Forward
            wf_test_period: –ü–µ—Ä–∏–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Walk-Forward
            mc_simulations: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–π
            bootstrap_samples: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Bootstrap –≤—ã–±–æ—Ä–æ–∫
            bootstrap_block_size: –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ –¥–ª—è Bootstrap
            
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏–∑–æ–≤
        """
        print("=" * 60)
        print("–ó–ê–ü–£–°–ö –ü–û–õ–ù–û–ì–û –ë–≠–ö–¢–ï–°–¢–ò–ù–ì–ê –°–¢–†–ê–¢–ï–ì–ò–ò")
        print("=" * 60)
        
        # 1. –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
        print("\n1. –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥...")
        self._run_basic_backtest()
        
        # 2. Walk-Forward –∞–Ω–∞–ª–∏–∑
        print("\n2. Walk-Forward –∞–Ω–∞–ª–∏–∑...")
        self._run_walk_forward_analysis(wf_train_period, wf_test_period)
        
        # 3. Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è
        print("\n3. Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è...")
        self._run_monte_carlo_analysis(mc_simulations)
        
        # 4. Bootstrap –∞–Ω–∞–ª–∏–∑
        print("\n4. Bootstrap –∞–Ω–∞–ª–∏–∑...")
        self._run_bootstrap_analysis(bootstrap_samples, bootstrap_block_size)
        
        # 5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        print("\n5. –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤...")
        self._create_visualizations()
        
        # 6. –û—Ç—á–µ—Ç
        print("\n6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞...")
        self._generate_report()
        
        return self._compile_results()
    
    def _run_basic_backtest(self) -> None:
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞"""
        backtester = LiquidityAwareBacktester(
            initial_capital=self.initial_capital,
            commission=self.commission,
            spread=self.spread
        )
        
        self.basic_results = backtester.run_backtest(self.data, self.strategy)
        print(f"  ‚úì –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω")
        print(f"  ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ {len(backtester.trades)} —Å–¥–µ–ª–æ–∫")
        print(f"  ‚úì –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {self.basic_results['total_return']:.2%}")
    
    def _run_walk_forward_analysis(self, train_period: int, test_period: int) -> None:
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞"""
        self.wf_results = walk_forward_analysis(
            self.data, self.strategy, train_period, test_period
        )
        wf_analysis = analyze_walk_forward_results(self.wf_results)
        print(f"  ‚úì Walk-Forward –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω")
        print(f"  ‚úì –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(self.wf_results)} –ø–µ—Ä–∏–æ–¥–æ–≤")
        print(f"  ‚úì –°—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {wf_analysis['avg_return']:.2%}")
    
    def _run_monte_carlo_analysis(self, n_simulations: int) -> None:
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Monte Carlo –∞–Ω–∞–ª–∏–∑–∞"""
        self.mc_results = monte_carlo_simulation(
            self.data, self.strategy, n_simulations
        )
        mc_analysis = analyze_monte_carlo_results(self.mc_results)
        print(f"  ‚úì Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
        print(f"  ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ {len(self.mc_results)} —Å–∏–º—É–ª—è—Ü–∏–π")
        print(f"  ‚úì –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏: {mc_analysis['probabilities']['positive_return']:.2%}")
    
    def _run_bootstrap_analysis(self, n_bootstrap: int, block_size: int) -> None:
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Bootstrap –∞–Ω–∞–ª–∏–∑–∞"""
        self.bootstrap_results = bootstrap_analysis(
            self.data, self.strategy, n_bootstrap, block_size
        )
        bootstrap_analysis = analyze_bootstrap_results(self.bootstrap_results)
        print(f"  ‚úì Bootstrap –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω")
        print(f"  ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ {len(self.bootstrap_results)} –≤—ã–±–æ—Ä–æ–∫")
        print(f"  ‚úì –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: "
              f"{bootstrap_analysis['return_ci']['lower']:.2%} - "
              f"{bootstrap_analysis['return_ci']['upper']:.2%}")
    
    def _create_visualizations(self) -> None:
        """–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤"""
        # –û—Å–Ω–æ–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
        plot_equity_curve_with_metrics(
            self.basic_results.get('equity_curve', []),
            self.basic_results
        )
        
        plot_drawdown_analysis(
            self.basic_results.get('equity_curve', [])
        )
        
        if self.basic_results.get('daily_returns'):
            plot_returns_analysis(self.basic_results['daily_returns'])
            plot_risk_return_scatter(self.basic_results['daily_returns'])
        
        # Walk-Forward –≥—Ä–∞—Ñ–∏–∫–∏
        if self.wf_results:
            self._plot_walk_forward_results()
        
        # Monte Carlo –≥—Ä–∞—Ñ–∏–∫–∏
        if self.mc_results:
            self._plot_monte_carlo_results()
    
    def _plot_walk_forward_results(self) -> None:
        """–ì—Ä–∞—Ñ–∏–∫–∏ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞"""
        wf_returns = [r['metrics']['total_return'] for r in self.wf_results]
        wf_periods = [r['period'] for r in self.wf_results]
        
        plt.figure(figsize=(15, 6))
        plt.plot(wf_periods, wf_returns, 'o-', linewidth=2, markersize=6)
        plt.axhline(y=0, color='red', linestyle='--', alpha=0.7)
        plt.title('Walk-Forward Analysis - Returns by Period', fontsize=14)
        plt.xlabel('Period', fontsize=12)
        plt.ylabel('Return', fontsize=12)
        plt.grid(True, alpha=0.3)
        plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(lambda x, p: f'{x:.1%}'))
        plt.tight_layout()
        plt.show()
    
    def _plot_monte_carlo_results(self) -> None:
        """–ì—Ä–∞—Ñ–∏–∫–∏ Monte Carlo –∞–Ω–∞–ª–∏–∑–∞"""
        mc_returns = [r['metrics']['total_return'] for r in self.mc_results]
        
        plt.figure(figsize=(12, 8))
        
        # –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
        plt.subplot(2, 2, 1)
        plt.hist(mc_returns, bins=50, alpha=0.7, density=True)
        plt.axvline(np.mean(mc_returns), color='red', linestyle='--', 
                   label=f'Mean: {np.mean(mc_returns):.2%}')
        plt.title('Monte Carlo Returns Distribution')
        plt.xlabel('Return')
        plt.ylabel('Density')
        plt.legend()
        plt.grid(True, alpha=0.3)
        
        # –ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        plt.subplot(2, 2, 2)
        sorted_returns = np.sort(mc_returns)
        cumulative = np.arange(1, len(sorted_returns) + 1) / len(sorted_returns)
        plt.plot(sorted_returns, cumulative, linewidth=2)
        plt.title('Cumulative Distribution Function')
        plt.xlabel('Return')
        plt.ylabel('Cumulative Probability')
        plt.grid(True, alpha=0.3)
        
        # –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π
        plt.subplot(2, 2, 3)
        plt.plot(mc_returns[:100], alpha=0.7)  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 100
        plt.title('Monte Carlo Returns (First 100)')
        plt.xlabel('Simulation')
        plt.ylabel('Return')
        plt.grid(True, alpha=0.3)
        
        # Box plot
        plt.subplot(2, 2, 4)
        plt.boxplot(mc_returns)
        plt.title('Monte Carlo Returns Box Plot')
        plt.ylabel('Return')
        plt.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.show()
    
    def _generate_report(self) -> None:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        print("\n" + "=" * 60)
        print("–û–¢–ß–ï–¢ –û –†–ï–ó–£–õ–¨–¢–ê–¢–ê–• –ë–≠–ö–¢–ï–°–¢–ò–ù–ì–ê")
        print("=" * 60)
        
        # –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        print("\nüìä –ë–ê–ó–û–í–´–ï –ú–ï–¢–†–ò–ö–ò:")
        print(f"  –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {self.basic_results['total_return']:.2%}")
        print(f"  –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {self.basic_results['annual_return']:.2%}")
        print(f"  –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: {self.basic_results['volatility']:.2%}")
        print(f"  Sharpe Ratio: {self.basic_results['sharpe_ratio']:.2f}")
        print(f"  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: {self.basic_results['max_drawdown']:.2%}")
        print(f"  Win Rate: {self.basic_results['win_rate']:.2%}")
        print(f"  Profit Factor: {self.basic_results['profit_factor']:.2f}")
        
        # Walk-Forward –∞–Ω–∞–ª–∏–∑
        if self.wf_results:
            wf_analysis = analyze_walk_forward_results(self.wf_results)
            print(f"\nüîÑ WALK-FORWARD –ê–ù–ê–õ–ò–ó:")
            print(f"  –ü–µ—Ä–∏–æ–¥–æ–≤: {wf_analysis['total_periods']}")
            print(f"  –°—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {wf_analysis['avg_return']:.2%}")
            print(f"  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: {wf_analysis['std_return']:.2%}")
            print(f"  –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤: {wf_analysis['positive_periods_pct']:.2%}")
            print(f"  –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏: {wf_analysis['consistency_score']:.2f}")
        
        # Monte Carlo –∞–Ω–∞–ª–∏–∑
        if self.mc_results:
            mc_analysis = analyze_monte_carlo_results(self.mc_results)
            print(f"\nüé≤ MONTE CARLO –ê–ù–ê–õ–ò–ó:")
            print(f"  –°–∏–º—É–ª—è—Ü–∏–π: {mc_analysis['n_simulations']}")
            print(f"  –°—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {mc_analysis['return_stats']['mean']:.2%}")
            print(f"  –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏–±—ã–ª–∏: {mc_analysis['probabilities']['positive_return']:.2%}")
            print(f"  VaR (95%): {mc_analysis['var_cvar']['var_95']:.2%}")
            print(f"  CVaR (95%): {mc_analysis['var_cvar']['cvar_95']:.2%}")
        
        # Bootstrap –∞–Ω–∞–ª–∏–∑
        if self.bootstrap_results:
            bootstrap_analysis = analyze_bootstrap_results(self.bootstrap_results)
            print(f"\nüìà BOOTSTRAP –ê–ù–ê–õ–ò–ó:")
            print(f"  –í—ã–±–æ—Ä–æ–∫: {bootstrap_analysis['n_bootstrap']}")
            print(f"  –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: "
                  f"{bootstrap_analysis['return_ci']['lower']:.2%} - "
                  f"{bootstrap_analysis['return_ci']['upper']:.2%}")
            print(f"  –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏: "
                  f"{'–î–∞' if bootstrap_analysis['significance']['return_significant'] else '–ù–µ—Ç'}")
    
    def _compile_results(self) -> Dict[str, Any]:
        """–ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        return {
            'basic_results': self.basic_results,
            'walk_forward_results': self.wf_results,
            'monte_carlo_results': self.mc_results,
            'bootstrap_results': self.bootstrap_results,
            'summary': {
                'total_return': self.basic_results['total_return'],
                'sharpe_ratio': self.basic_results['sharpe_ratio'],
                'max_drawdown': self.basic_results['max_drawdown'],
                'win_rate': self.basic_results['win_rate']
            }
        }

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
def run_complete_backtest_example():
    """
    –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    
    –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å CompleteBacktest
    –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    """
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    class SimpleMovingAverageStrategy:
        def __init__(self, short_window=20, long_window=50):
            self.short_window = short_window
            self.long_window = long_window
            self.short_ma = None
            self.long_ma = None
        
        def get_signal(self, data):
            if len(data) < self.long_window:
                return 'HOLD'
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ
            short_ma = data['Close'].rolling(self.short_window).mean().iloc[-1]
            long_ma = data['Close'].rolling(self.long_window).mean().iloc[-1]
            
            # –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
            if short_ma > long_ma:
                return 'BUY'
            elif short_ma < long_ma:
                return 'SELL'
            else:
                return 'HOLD'
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    np.random.seed(42)
    dates = pd.date_range('2020-01-01', '2023-12-31', freq='D')
    prices = 100 * np.cumprod(1 + np.random.normal(0.0005, 0.02, len(dates)))
    
    data = pd.DataFrame({
        'Open': prices * (1 + np.random.normal(0, 0.001, len(dates))),
        'High': prices * (1 + np.abs(np.random.normal(0, 0.01, len(dates)))),
        'Low': prices * (1 - np.abs(np.random.normal(0, 0.01, len(dates)))),
        'Close': prices,
        'Volume': np.random.randint(1000, 10000, len(dates))
    }, index=dates)
    
    # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
    strategy = SimpleMovingAverageStrategy()
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    backtest = CompleteBacktest(data, strategy)
    results = backtest.run_complete_analysis()
    
    return results

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
if __name__ == "__main__":
    results = run_complete_backtest_example()
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫:

- **[07_walk_forward_analysis.md](07_walk_forward_analysis.md)** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ Walk-Forward –∞–Ω–∞–ª–∏–∑–∞
- **[08_monte_carlo_simulation.md](08_monte_carlo_simulation.md)** - –£–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏–∏
- **[09_risk_management.md](09_risk_management.md)** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö
- **[10_portfolio_optimization.md](10_portfolio_optimization.md)** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ò–∑–±–µ–≥–∞–π—Ç–µ look-ahead bias** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
2. **–£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å** - –∫–æ–º–∏—Å—Å–∏–∏, —Å–ø—Ä–µ–¥—ã, –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Walk-Forward –∞–Ω–∞–ª–∏–∑
4. **–û—Ü–µ–Ω–∏–≤–∞–π—Ç–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å** - –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—é
5. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Bootstrap –∞–Ω–∞–ª–∏–∑

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å:** –û–±—â–∞—è, –≥–æ–¥–æ–≤–∞—è, —Å—Ä–µ–¥–Ω—è—è
- **–†–∏—Å–∫:** –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞, VaR
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** Sharpe ratio, Sortino ratio, Calmar ratio
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** Win rate, profit factor, recovery factor

### ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

- **Look-ahead bias** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **Survivorship bias** - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ "–º–µ—Ä—Ç–≤—ã—Ö" –∞–∫—Ç–∏–≤–æ–≤
- **Overfitting** - –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫** - –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–ù–µ–¥–æ–æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤** - —Ñ–æ–∫—É—Å —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

### üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **–ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç–µ—Ä** - –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–µ—Ä** - —Å —É—á–µ—Ç–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫
- **–ë—ç–∫—Ç–µ—Å—Ç–µ—Ä —Å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é** - —Å —É—á–µ—Ç–æ–º –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è
- **Walk-Forward –∞–Ω–∞–ª–∏–∑** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **Monte Carlo —Å–∏–º—É–ª—è—Ü–∏—è** - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏
- **Bootstrap –∞–Ω–∞–ª–∏–∑** - –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

- **–ö—Ä–∏–≤—ã–µ –∫–∞–ø–∏—Ç–∞–ª–∞** - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ–±—â–µ–π —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏
- **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ—Å–∞–¥–æ–∫** - –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∏—Å–∫–æ–≤
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏** - –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **–°–∫–æ–ª—å–∑—è—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏** - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

---

## üéì –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö

1. –ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–µ—Ä–∞
2. –ò–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
3. –ù–∞—É—á–∏—Ç–µ—Å—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å

### –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –º–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞
2. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
3. –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
4. –ü—Ä–æ–≤–æ–¥–∏—Ç–µ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### –î–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞
3. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—ã –∞–ª–µ—Ä—Ç–æ–≤

---

**üí° –ü–æ–º–Ω–∏—Ç–µ:** –•–æ—Ä–æ—à–∏–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≤—ã—Å–æ–∫–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –∞ **—Å—Ç–∞–±–∏–ª—å–Ω–∞—è, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–∞—è** –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞!
